<screens xmlns="http://www.webhare.net/xmlns/tollium/screens" gid="tolliumapps.deploy" library="deploy.whlib">

  <screen name="main"
          minwidth="150x"
          minheight="30x"
          allowresize="true"
          flags="developer           connected"
          gid=".main"
          icon="tollium:system/system"
          menubar="menubar"
          onmessage="onmessage"
          onunload="gotunload"
          savestate="size">
    <actions>
      <action name="refresh" onexecute="dorefresh" tid="~refresh" />
      <action name="deploymodule" onexecute="dodeploymodule">
        <enableon source="modules" min="1" max="1" checkflags="candownload" frameflags="connected" requirefocus="true" />
      </action>
      <action name="browsemodule" onexecute="dobrowsemodule">
        <enableon source="modules" min="1" max="1" requirefocus="true" />
      </action>
      <action name="langedit" frameflags="developer" onexecute="dolangedit">
        <enableon source="modules" min="1" max="1" />
      </action>
      <action name="forges" onexecute="doforges" />
      <action name="connectremote" frameflags="developer" onexecute="doconnectremote" shortcut="ctrl+p" />
      <windowopenaction name="openrepository" onwindowopen="onopenrepository">
        <enableon source="modules" min="1" max="1" checkflags="havewebsite" />
      </windowopenaction>
      <windowopenaction name="jsonschemas" onwindowopen="dojsonschemas" />
      <action name="disconnectremote" frameflags="developer connected" onexecute="dodisconnectremote" tid="~disconnect" />
      <action name="reviewmodulepeerchanges" onexecute="doreviewmodulepeerchanges">
        <enableon source="peermodules" min="1" max="1" />
      </action>
      <action name="reviewremotetolocaldiff">
        <enableon source="modules" min="1" max="1" checkflags="isinstalledonpeer" onexecute="doreviewremotetolocaldiff_local" />
        <enableon source="peermodules" min="1" max="1" checkflags="ispresentlocal" onexecute="doreviewremotetolocaldiff_peer" />
      </action>
      <action name="reviewincomingcommits" onexecute="doreviewincomingcommits">
        <enableon source="peermodules" min="1" max="1" />
      </action>
      <downloadaction name="downloadmodule" ondownload="dodownloadmodule" tid="~download">
        <enableon source="modules" min="1" max="1" checkflags="candownload" />
      </downloadaction>
      <action name="close" onexecute="DoClose" tid="~exit" />
    </actions>

    <menus>
      <menu name="menubar">
        <item action="forges" />
        <item action="langedit" disablemode="hidden" />
        <divider />
        <item action="openrepository" />
        <item action="deploymodule" />
        <item action="downloadmodule" />
        <divider />
        <item action="browsemodule" />
        <item name="devpages">
          <item action="jsonschemas" />
        </item>
        <divider />
        <item action="refresh" />
        <item action="close" />
      </menu>
      <menu name="noselection_modules" />
      <menu name="selection_modules">
        <item action="langedit" />
        <item action="browsemodule" />
        <divider />
        <item action="openrepository" />
        <item action="deploymodule" />
        <item action="downloadmodule" />
      </menu>
      <menu name="selection_peermodules">
        <item action="reviewmodulepeerchanges" />
        <item action="reviewremotetolocaldiff" />
        <item action="reviewincomingcommits" />
      </menu>
    </menus>

    <compositions>
      <eventlistener name="giteventlistener"
                     groupinterval="1000"
                     masks="system:modulefolder.mod::*/.git/*"
                     onevents="GotGitEvent" />
      <eventlistener name="moduleeventlistener"
                     groupinterval="1000"
                     masks="system:softreset system:moduleupdate"
                     onevents="GotModuleEvent" />
    </compositions>

    <toolbar>
      <button name="connectremotebutton" action="connectremote" icon="tollium:objects/rackserver" tid=".connectremote" />
      <button name="deploymodulebutton" action="deploymodule" icon="tollium:system/deploy" tid=".deploymodule" />
      <divider />
      <button action="langedit" icon="tollium:actions/translate" />
      <button action="browsemodule" icon="tollium:database/sql_client" />

      <!-- <button action="disconnectremote" icon="tollium:system/disconnect" name="disconnectremotebutton" tid="~disconnect"/> -->
    </toolbar>

    <body height="1pr" layout="form" spacers="bottom">
      <split type="horizontal">
        <part name="localmodules" width="1pr" spacers="none">
          <panel backgroundcolor="#f0f0f0" spacers="left right">
            <line layout="tabs-space">
              <!-- buttongroup layout="horizontal" borders="right" name="folderbuttonsfilespacegroup">
                <button name="showpart" icon="tollium:buttonbar/showpart" type="icon" action="togglefoldertree" />
                <button name="folderup" icon="tollium:actions/levelup" type="icon" action="goup" hinttid=".folderuphint"/>
                <button name="folderpath2" icon="tollium:buttonbar/folderpath" type="icon"/>
              </buttongroup -->
              <spacer />
              <text name="localheading" title="" value="" />

              <!-- buttongroup layout="horizontal" borders="left right" name="sortbuttonsgroup">
                <button name="movetotopbutton" action="movetotop" icon="tollium:actions/to_top" type="icon" hinttid=".movetotophint" />
                <button name="moveupbutton" action="moveup" icon="tollium:actions/up" type="icon" hinttid=".moveuphint" />
                <button name="movedownbutton" action="movedown" icon="tollium:actions/down" type="icon" hinttid=".movedownhint"/>
                <button name="movetobottombutton" action="movetobottom" icon="tollium:actions/to_bottom" type="icon" hinttid=".movetobottomhint" />
              </buttongroup>
              <buttongroup layout="horizontal" borders="left">
                <button name="filelistmulti" action="setfilelistmulti" icon="tollium:buttonbar/showmultirow" type="icon" hinttid=".filelistmultihint" />
                <button name="filelistsingle" action="setfilelistsingle" icon="tollium:buttonbar/showsinglerow" type="icon" hinttid=".filelistsinglehint" />
              </buttongroup -->
            </line>
          </panel>
          <panel height="1pr">
            <list name="modules"
                  height="1pr"
                  borders="top bottom"
                  flags="canmanage candownload canseeversions havewebsite"
                  icons="tollium:files/text_plain tollium:objects/webhare tollium:tollium/tollium tollium:status/versioned"
                  newcontextmenu="noselection_modules"
                  ongetrows="getmodules"
                  selectcontextmenu="selection_modules"
                  selectmode="single"
                  sortcolumn="name">
              <column name="name" type="text" width="1pr" iconname="typeicon" />
              <column name="version" type="text" width="16x" align="right" />
              <column name="revision" type="text" width="1pr" />
              <column name="description" type="text" width="3pr" tid="~description" />
              <column name="lastmodified" type="datetime" width="16x" precision="minutes" storeutc="true" />
              <style name="deleted" textcolor="#AAAAAA" />
            </list>
          </panel>
        </part>
        <part name="remotemodules" width="1pr" spacers="none">
          <panel backgroundcolor="#f0f0f0" spacers="left">
            <line layout="tabs-space">
              <text name="peerheading" title="" />
              <url name="peerurl" width="1pr" title="" />
              <buttongroup borders="right" layout="horizontal">
                <button type="icon" action="disconnectremote" hinttid="~disconnect" icon="tollium:actions/delete" />
                <button type="icon" action="refresh" hinttid="~refresh" icon="tollium:actions/reload" />
              </buttongroup>
            </line>
          </panel>
          <tabs name="peertabs" type="server" height="1pr">
            <tab>
              <list name="peermodules"
                    height="1pr"
                    borders="top bottom"
                    emptytid=".peerhasnomodules"
                    flags="ispresentlocal outofdate"
                    icons="tollium:tools/tools
                           tollium:status/checked
                           tollium:status/unknown
                           tollium:status/outdated
                           tollium:status/differentbranch"
                    ongetrows="getpeermodules"
                    selectcontextmenu="selection_peermodules"
                    selectmode="single"
                    sortcolumn="name">
                <column name="name" type="text" width="1pr" hintname="outofdatehint" iconname="outofdateicon" />
                <column name="version" type="text" width="12x" align="right" />
                <column name="showrevision" type="text" width="24x" tid=".revision" />
              </list>
            </tab>
          </tabs>
        </part>
      </split>
    </body>
  </screen>

</screens>

<?wh

LOADLIB "wh::util/algorithms.whlib";


/// Indexmanager connections, mapping from indexmanager id to [ (STRING)address, (STRING)prefix, (OBJECT)browser ] records
PUBLIC OBJECT indexmanagerconnections := NEW ValueMapper();

/// Are we running within a fetcher?
PUBLIC BOOLEAN running_in_fetcher;
/// Are we allowed to print Defer: Connection?
PUBLIC BOOLEAN print_defer_connection := TRUE;

/// Number of times to try to connect to the Consilio index manager
PUBLIC CONSTANT INTEGER consilio_maxtries := 3;
/// Timeout for Consilio index manager connections, in seconds
PUBLIC CONSTANT INTEGER consilio_timeout := 30;

/// Timeout for Elasticsearch connections, in seconds
PUBLIC CONSTANT INTEGER elastic_timeout := 30;

/// Timeout for search sessions, in minutes
PUBLIC CONSTANT INTEGER session_timeout := 15;

/// Some default field mapping for OpenSearch content sources
PUBLIC CONSTANT RECORD ARRAY defaultmappingfields :=
    [ [ name := "indexid",         defaultvalue := "", type := "keyword" ]
    , [ name := "groupid",         defaultvalue := "", type := "keyword" ]
    , [ name := "objectid",        defaultvalue := "", type := "keyword" ]
    , [ name := "date_indexdate",  defaultvalue := DEFAULT DATETIME ]
    , [ name := "date_indexed",    defaultvalue := DEFAULT DATETIME ]
    , [ name := "contentprovider", defaultvalue := "", type := "keyword" ]
    , [ name := "contentsource",   defaultvalue := "", type := "keyword" ]
    , [ name := "body",            defaultvalue := "", tokenized := TRUE ]
    , [ name := "objecturl",       defaultvalue := "", type := "keyword" ]
    ];

<?wh

LOADLIB "wh::util/algorithms.whlib";


/// Indexmanager connections, mapping from indexmanager id to [ (STRING)address, (STRING)prefix, (OBJECT)browser ] records
PUBLIC OBJECT indexmanagerconnections := NEW ValueMapper();

/// Are we running within a fetcher?
PUBLIC BOOLEAN running_in_fetcher;
/// Are we allowed to print Defer: Connection?
PUBLIC BOOLEAN print_defer_connection := TRUE;

/// Timeout for OpenSearch read connections, in milliseconds (5 seconds)
PUBLIC CONSTANT INTEGER opensearch_read_timeout := 5000;

/// Timeout for OpenSearch write connections, in milliseconds (5 minutes)
PUBLIC CONSTANT INTEGER opensearch_write_timeout := 300000;

/// Timeout for OpenSearch to come online the first time (60 seconds)
PUBLIC CONSTANT INTEGER opensearch_firstconnect_timeout := 60000;

/// Some default field mapping for OpenSearch content sources
PUBLIC CONSTANT RECORD ARRAY defaultmappingfields :=
    [ [ name := "groupid",         defaultvalue := "", type := "keyword" ]
    , [ name := "objectid",        defaultvalue := "", type := "keyword" ]
    , [ name := "body",            defaultvalue := "", tokenized := TRUE ]
    , [ name := "objecturl",       defaultvalue := "", type := "keyword" ]
    , [ name := "_indexdate",      defaultvalue := DEFAULT DATETIME ]
    , [ name := "_indexed",        defaultvalue := DEFAULT DATETIME ]
    , [ name := "_contentsource",  defaultvalue := "", type := "keyword" ]
    ];

<?wh
/** @private Catalog management should be done through api.whlib */

LOADLIB "mod::system/lib/database.whlib";

/** @loadlib mod::consilio/lib/internal/dbschema.whlib
    @schemadef consilio
*/
PUBLIC SCHEMA
  < TABLE
    < INTEGER "id" NULL := 0
    , INTEGER "indexmanager" NULL := 0
    , STRING "name"
    , STRING "description"
    , INTEGER "loglevel"
    , INTEGER "priority"
    , BOOLEAN "rebuild"
    , INTEGER "type"
    , STRING "indexname"
    ; KEY id
    > indices
  , TABLE
    < INTEGER "id" NULL := 0
    , STRING "contentprovider"
    , STRING "data"
    , BOOLEAN "discardsummaries"
    , INTEGER "indexid" NULL := 0
    , INTEGER "maxgroupobjects"
    , STRING "tag"
    , STRING "title"
    , INTEGER "status"
    , DATETIME "last_indexed"
    , DATETIME "orphansince"
    , STRING "definedby"
    , BOOLEAN "publishercontent"
    , INTEGER "fsobject" NULL := 0
    ; KEY id
    > contentsources
  , TABLE
    < INTEGER "id" NULL := 0
    , INTEGER "contentsourceid" NULL := 0
    , STRING "name"
    , STRING "defaultvalue"
    , BOOLEAN "tokenized"
    , BOOLEAN "suggested"
    ; KEY id
    > contentsourcefields
  , TABLE
    < INTEGER "id" NULL := 0
    , DATETIME "checked"
    , INTEGER "checktime"
    , DATETIME "last_referred"
    , DATETIME "nextcheck"
    , INTEGER "status"
    , STRING "url"
    , INTEGER "hashed_url_int"
    ; KEY id
    > checked_links
  , TABLE
    < INTEGER "id" NULL := 0
    , INTEGER "link" NULL := 0
    , INTEGER "system_fs_setting" NULL := 0
    , STRING "text"
    , STRING "url"
    , INTEGER "wrd_entity_setting" NULL := 0
    ; KEY id
    > checked_objectlinks
  , TABLE
    < INTEGER "id" NULL := 0
    , STRING "server"
    , INTEGER "status"
    , DATETIME "nextcheck"
    , DATETIME "down_since"
    ; KEY id
    > checked_servers
  , TABLE
    < INTEGER "id" NULL := 0
    , STRING "query"
    , DATETIME "when"
    , INTEGER "indexid" NULL := 0
    , INTEGER "pages"
    , STRING "sess"
    , INTEGER "results"
    , INTEGER "site" NULL := 0
    , STRING "tag"
    ; KEY id
    > query_results
  , TABLE
    < INTEGER "id" NULL := 0
    , INTEGER "query" NULL := 0
    , STRING "url"
    ; KEY id
    > query_clicks
  , TABLE
    < INTEGER "id" NULL := 0
    , STRING "name"
    , INTEGER "type"
    , STRING "address"
    , BOOLEAN "secure"
    , BOOLEAN "enablestemming"
    , INTEGER "loglevel"
    ; KEY id
    > indexmanagers
  , TABLE
    < INTEGER "id" NULL := 0
    , INTEGER "indexid" NULL := 0
    , INTEGER "wordgroup"
    , STRING "word"
    ; KEY id
    > thesaurus
  , TABLE
    < INTEGER "id" NULL := 0
    , STRING "pattern"
    , BOOLEAN "nolinkcheck_from"
    , BOOLEAN "nolinkcheck_to"
    , BOOLEAN "noindex"
    , BOOLEAN "nofollow"
    , BOOLEAN "pattern_regex"
    ; KEY id
    > blacklist
  > consilio;

/** @short Bind the module tables
    @long This macro binds all of the search module's tables to the specified transaction
    @param transaction Transaction ID to bind the tables to */
MACRO BindConsilioTables(INTEGER transaction)
{
  consilio := BindTransactionToSchema(transaction, "consilio");
}

SetupPrimaryTransactionBinder(PTR BindConsilioTables);

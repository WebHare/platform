<?wh
/** @private Format parser. (may be replaced with tika at some point) */

LOADLIB "wh::files.whlib";
LOADLIB "mod::consilio/lib/internal/support.whlib";
LOADLIB "mod::consilio/lib/parsers/parser_support.whlib";

// Maximum length of plain text file title
INTEGER max_title_length := 80;

/** @short Parse a plain text document
    @param data The document to parse
    @return Information for the document
    @cell return.success If page was parsed
    @cell return.errormsg If not parse, the error message
    @cell return.index_page This page should be indexed (always TRUE for plain text)
    @cell return.keywords Keywords for the page (left empty for plain text)
    @cell return.description Description for the page (left empty for plain text)
    @cell return.links The links found in this page (left empty in plain text)
    @cell return.text The contents of the page */
PUBLIC RECORD FUNCTION ParsePlainTextDoc(BLOB data, BOOLEAN contentlinksonly)
{
  // Default parsed page
  RECORD parsed_page := CreateParsedPage();
  parsed_page.type_ext := "txt";
  // Insert body text. TODO configurable or at least a limit we've put more thought in ?
  parsed_page.text := CleanWhitespace(BlobToString(data, 65536));

  RETURN parsed_page;
}

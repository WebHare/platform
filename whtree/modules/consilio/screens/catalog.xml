<screens xmlns="http://www.webhare.net/xmlns/tollium/screens"
         xmlns:consilio="http://www.webhare.net/xmlns/consilio/components"
         xmlns:publisher="http://www.webhare.net/xmlns/publisher/components"
         xmlns:system="http://www.webhare.net/xmlns/system/components"
         gid="catalog"
         library="/lib/screens/catalog.whlib">

  <screen name="catalogs"
          allowresize="true"
          flags="issysop ismanager iseditor"
          gid=".catalogs"
          icon="consilio:consilio"
          interval="60000"
          menubar="mainmenu"
          oninterval="dorefresh"
          savestate="size"
          tid=".title">
    <actions>
      <action name="options" frameflags="issysop" onexecute="dooptions" shortcut="ctrl+," />
      <action name="blacklist" frameflags="issysop" onexecute="doblacklist" />
      <action name="showerrors" onexecute="doshowerrors">
        <enableon source="catalogs" min="1" max="1" checkflags="haserrors" />
      </action>
      <action name="addcontentsource" onexecute="doaddcontentsource" shortcut="ctrl+alt+n">
        <enableon source="catalogs" min="1" max="1" checkflags="standardcatalog !readonly manageable" />
      </action>
      <action name="edititem">
        <enableon source="catalogs" min="1" max="1" checkflags="catalog !readonly manageable" onexecute="doeditcatalog" />
        <enableon source="catalogs"
                  min="1"
                  max="1"
                  checkflags="contentsource !readonly manageable"
                  onexecute="doeditcontentsource" />
      </action>
      <action name="delete" shortcut="del" tid="~delete">
        <enableon source="catalogs" min="1" checkflags="!readonly manageable" onexecute="dodelete" />
      </action>
      <action name="showfieldmapping">
        <enableon source="catalogs" min="1" max="1" checkflags="catalog" onexecute="doshowfieldmapping" />
      </action>
      <action name="previewcatalog" onexecute="dopreviewcatalog" shortcut="ctrl+shift+p">
        <enableon source="catalogs" min="1" max="1" checkflags="previewable" />
      </action>
      <action name="rebuildcatalog" onexecute="dorebuildcatalog" shortcut="ctrl+shift+c">
        <enableon source="catalogs" min="1" max="1" checkflags="catalog hascontents !inactive manageable" />
        <enableon source="catalogs" min="1" max="1" checkflags="contentsource !inactive manageable" />
      </action>
      <action name="markcatalogascomplete" onexecute="domarkcatalogascomplete">
        <enableon source="catalogs" min="1" max="1" checkflags="isupdateorrebuild" />
      </action>
      <action name="catalogthesaurus" onexecute="docatalogthesaurus">
        <enableon source="catalogs" min="1" max="1" checkflags="catalog !readonly editable" />
      </action>
      <action name="exit" onexecute="doexit" tid="~exit" />
    </actions>

    <menus>
      <menu name="mainmenu">
        <item tid="common.terms.catalog">
          <item name="addcontentsource_menu" action="addcontentsource" tid=".addcontentsource" />
          <divider />
          <item name="edititem_menu" action="edititem" tid=".edititem" />
          <item name="deleteitem_menu" action="delete" tid="~delete" />
          <divider />
          <item action="previewcatalog" />
          <item name="rebuildcatalog_menu" action="rebuildcatalog" tid=".rebuildcatalog" />
          <item name="showerrors_menu" action="showerrors" tid=".showerrors" />
          <item action="markcatalogascomplete" />
          <divider />
          <item name="catalogthesaurus_menu" action="catalogthesaurus" tid=".catalogthesaurus" />
          <item action="showfieldmapping" />
        </item>
        <item action="blacklist" disablemode="hidden" />
        <divider />
        <item action="options" disablemode="hidden" />
        <divider />
        <item action="exit" disablemode="hidden" />
      </menu>
      <menu name="addmenu">
        <item action="addcontentsource" />
      </menu>
      <menu name="contextmenu">
        <item name="edititem_contextmenu" action="edititem" tid=".edititem" />
        <item name="rebuildcatalog_contextmenu" action="rebuildcatalog" tid=".rebuildcatalog" />
        <item name="showerrors_contextmenu" action="showerrors" tid=".showerrors" />
        <item name="catalogthesaurus_contextmenu" action="catalogthesaurus" tid=".catalogthesaurus" />
        <divider />
        <item action="showfieldmapping" />
        <item action="markcatalogascomplete" disablemode="hidden" />
        <item action="delete" />
      </menu>
    </menus>

    <toolbar>
      <button name="addmenu_button" icon="tollium:actions/add" menu="addmenu" tid="~add" />
      <button name="edititem_button" action="edititem" icon="tollium:actions/edit" tid="~edit" />
      <button name="deleteitem_button" action="delete" icon="tollium:actions/delete" tid="~delete" />
      <divider type="line" />
      <button name="checkcatalog_button" action="rebuildcatalog" icon="tollium:agenda/tasks" tid=".rebuildcatalog" />
      <button action="previewcatalog" icon="tollium:actions/search" tid=".preview" />
    </toolbar>

    <body>
      <panel height="1pr">
        <list name="catalogs"
              height="1pr"
              minwidth="75x"
              minheight="20x"
              emptytid=".nocatalogs"
              eventmasks="consilio:contentsourceschanged"
              flags="catalog contentsource hascontents previewable editable manageable inactive readonly haserrors standardcatalog isupdateorrebuild"
              ongetrows="ongetcatalogs"
              openaction="edititem"
              savestate="selection expanded"
              selectcontextmenu="contextmenu"
              selectmode="multiple">
          <column name="tag" type="text" width="1pr" tid="~tag" tree="true" />
          <column name="title" type="text" width="2pr" tid="~title" />
          <column name="lang" type="text" width="8x" />
          <column name="definedby" type="text" width="1pr" />
          <column name="size" type="integer" width="10x" align="right" emptyvalue="-1" />
          <column name="status" type="icon" hintname="statushint" />
          <column name="error" type="icon" hintname="errorhint" />
          <style name="inactive" textcolor="#666666" />
          <style name="readonly" textcolor="#000000" />
        </list>
      </panel>
    </body>

    <footer name="buttons">
      <defaultformbuttons buttons="close" />
    </footer>
  </screen>

  <screen name="options" footerbuttons="ok cancel" gid=".options">
    <compositions>
      <system:registrynode name="queuemanager" node="consilio.queuemanager" />
    </compositions>

    <body>
      <textedit composition="queuemanager"
                cellname="workers"
                name="numworkers"
                width="5x"
                tid=".numworkers"
                valuetype="integer" />
      <line>
        <textedit composition="queuemanager"
                  cellname="maxfetchtime"
                  name="maxtasktime"
                  width="5x"
                  tid=".maxtasktime"
                  valuetype="integer" />
        <text title="" valuetid=".seconds" />
      </line>
      <line>
        <select composition="queuemanager"
                cellname="loglevel"
                name="debuglevel_queuemanager"
                type="radio"
                rowkeytype="integer"
                tid=".debuglevel_queuemanager">
          <option rowkey="0" />  <!-- Errors only -->

          <!-- option rowkey="1" /><!- - Skipped documents -->
          <option rowkey="2" />  <!-- General information -->
          <option rowkey="3" />  <!-- All debugging information -->
        </select>
      </line>
      <line layout="left">
        <checkbox name="enablelinkchecker" labeltid=".enablelinkchecker" title="" />
      </line>
    </body>
  </screen>

  <screen name="blacklist" height="25x" allowresize="true" gid=".blacklist" savestate="size" footerbuttons="close">
    <body>
        <listedit name="blacklist"
              width="1pr"
              height="1pr"
              minwidth="60x"
              minheight="10x"
              emptytid=".nopatterns"
              icons="tollium:status/positive"
              onrowedit="editpattern"
              onrowdelete="deletepattern"
              ongetrows="getblacklistrows"
              eventmasks="consilio:blacklistchanged">
          <column name="pattern" type="text" />
          <column name="noindex_icon" type="icon" />
          <column name="nolinkcheck_to_icon" type="icon" />
        </listedit>
   </body>
  </screen>

  <screen name="blacklistpattern" footerbuttons="ok cancel" gid=".blacklistpattern" title="">
    <body>
      <textedit name="pattern" width="1pr" required="true" />
      <select name="options" type="checkbox">
        <option rowkey="noindex" />
        <option rowkey="nolinkcheck_to" />
      </select>
    </body>
  </screen>

  <screen name="catalogeditor"
          width="120x"
          allowresize="true"
          footerbuttons="ok cancel"
          gid=".catalogeditor"
          interval="60000"
          oninterval="GotInterval"
          title="">
    <body>
      <text name="id" tid=".id" />
      <textedit name="name" width="1pr" required="true" tid="~name" />
      <textarea name="description" width="1pr" height="4x" tid="~description" />
      <line>
        <select name="debuglevel" type="radio" rowkeytype="integer">
          <option rowkey="0" />  <!-- Errors only -->
          <option rowkey="1" />  <!-- Skipped documents -->
          <option rowkey="2" />  <!-- General information -->
          <option rowkey="3" />  <!-- All debugging information -->
        </select>
      </line>
      <line>
        <textedit name="priority" maxlength="2" minvalue="-9" maxvalue="9" valuetype="integer" />
        <text valuetid=".prorityexplain" />
      </line>
      <select name="type" type="pulldown" readonly="true" rowkeytype="integer">
        <option rowkey="0" tid=".type-standard" />
        <option rowkey="1" tid=".type-module" />
      </select>
      <text name="fieldgroups" width="1pr" wordwrap="true" />
       <heading tid=".indexmanagers" />
      <listedit name="attachedindices"
                height="1pr"
                highlightname="primary"
                ongetrows="GetAttachedIndices"
                onrowdelete="GotIndexManagerRowDelete"
                onrowedit="GotIndexManagerRowEdit">
        <column name="indexmanager_name" type="text" />
        <column name="indexname" type="text" />
        <column name="size" type="integer" width="10x" align="right" emptyvalue="-1" />
      </listedit>
    </body>
  </screen>

  <screen name="editcatalogindex" footerbuttons="ok cancel" gid=".editcatalogindex">
    <body>
      <select name="indexmanager" type="pulldown" onchange="OnGotIndexManagerChange" required="true" rowkeytype="integer" />
      <textedit name="indexname" width="1pr" minwidth="40x" />
      <textedit name="searchpriority" maxlength="6" minvalue="0" maxvalue="1000" emptyvalue="0" valuetype="integer" />
    </body>
  </screen>

  <screen name="catalogpreview"
          width="100x"
          height="30x"
          allowresize="true"
          gid=".catalogpreview"
          savestate="size"
          tid=".title">
    <actions>
      <action name="search" onexecute="dosearch" />
      <action name="viewitem" onexecute="doviewitem" title="" />
    </actions>

    <body>
      <line>
        <textedit name="query" width="1pr" defaultbutton="searchbutton">
          <consilio:autosuggest name="consilio_autosuggest" />
        </textedit>
        <button name="searchbutton" action="search" tid=".search" />
      </line>
      <panel height="1pr">
        <panel name="resultsinfo" backgroundcolor="#FEFFDE" visible="false">
          <panel layout="left">
            <text name="resultsmessage" width="1pr" onclicklink="onmessageclick" title="" value="" wordwrap="true" />
          </panel>
        </panel>
        <list name="results" openaction="viewitem" selectmode="single" sortable="true">
          <column name="id" type="integer" width="5x" align="right" />
          <column name="url" type="text" width="1pr" />
          <column name="score" type="text" width="10x" align="right" />
        </list>
      </panel>
    </body>

    <footer>
      <grid>
        <col width="1pr" />
        <col />
        <row>
          <cell layout="left">
            <text name="status" title="" value="" />
          </cell>
          <cell>
            <defaultformbuttons buttons="close" />
          </cell>
        </row>
      </grid>
    </footer>
  </screen>

  <screen name="catalogpreviewitem"
          minwidth="80x"
          minheight="30x"
          allowresize="true"
          gid=".catalogpreviewitem"
          savestate="size"
          tid=".title">
    <body name="body">
      <list name="fields" columnheaders="false" sortable="false">
        <column name="name" type="text" width="2pr" title="" tree="true" />
        <column name="value" type="text" width="3pr" collapsedname="collapsedvalue" linkname="link" title="" />
        <style name="heading" bold="true" />
      </list>
    </body>

    <footer>
      <grid>
        <cell width="1pr">
          <checkbox name="showempty" labeltid=".showempty" onchange="onshowemptychange" title="" />
        </cell>
        <cell>
          <defaultformbuttons buttons="close" />
        </cell>
      </grid>
    </footer>
  </screen>

  <screen name="contentsourceeditor" footerbuttons="ok cancel" gid=".contentsourceeditor" title="">
    <body>
      <text name="contentsourcetype" />
      <publisher:browseforobject name="folder" width="1pr" acceptfiles="false" required="true" />
      <text name="lastcontentscheck" />
      <text name="id" tid="~id" />
      <text name="tag" tid="~tag" />
      <heading tid=".generalsettings" />
      <textedit name="contentcheckinterval" maxlength="5" emptyvalue="0" suffixtid="~units.minutes" valuetype="integer" />
      <lines layout="left">
        <checkbox name="disablesource" labeltid=".disablesource-description" title="" />
      </lines>
    </body>
  </screen>

  <screen name="thesaurus" allowresize="true" footerbuttons="ok cancel" gid=".thesaurus" savestate="size" title="">
    <body>
      <!-- ADDME: How to filter an arrayedit?
      <textedit name="search" title="" placeholdertid="~search" onchange="dosearchwords" width="1pr" />
       -->
      <arrayedit name="words"
                 width="1pr"
                 height="1pr"
                 minwidth="60x"
                 minheight="15x"
                 emptytid=".nowords"
                 onmaprows="mapwordgroups"
                 roweditscreen="#thesauruswords">
        <column name="wordgroup" type="text" />
      </arrayedit>
    </body>
  </screen>

  <screen name="thesauruswords" allowresize="true" footerbuttons="ok cancel" gid=".thesaurus" savestate="size">
    <compositions>
      <record name="row" />
    </compositions>

    <body>
      <arrayedit name="words"
                 width="1pr"
                 height="1pr"
                 minwidth="20x"
                 minheight="5x"
                 columnheaders="false"
                 errorlabeltid=".words"
                 minrows="2"
                 onchange="onwordschange"
                 onmaprows="mapwords"
                 roweditscreen="#thesaurusword"
                 sortable="false">
        <column name="word" type="text" title="" />
      </arrayedit>
      <select composition="row" cellname="words" name="wordgroup" type="checkbox" rowkeytype="string" visible="false" />
    </body>
  </screen>

  <screen name="thesaurusword" footerbuttons="ok cancel" gid=".thesaurus">
    <compositions>
      <record name="row" />
    </compositions>

    <body>
      <panel height="1pr">
        <textedit composition="row" cellname="word" name="word" width="20x" required="true" />
      </panel>
    </body>
  </screen>

  <screen name="contentsourceerrors"
          width="130x"
          height="40x"
          allowresize="true"
          gid=".contentsourceerrors"
          savestate="position size">
    <actions>
      <action name="close" onexecute="cancel" />
      <action name="clear" onexecute="doclear" />
    </actions>

    <body>
      <list name="errors" selectmode="single" sortable="false">
        <column name="error" type="text" tree="true" />
        <column name="func" type="text" />
        <column name="linetext" type="text" width="7x" />
        <column name="coltext" type="text" width="7x" />
      </list>
    </body>

    <footer>
      <line layout="right">
        <button action="clear" />
        <button action="close" />
      </line>
    </footer>
  </screen>

  <screen name="fieldmapping"
          width="120x"
          height="18gr"
          allowresize="true"
          footerbuttons="close"
          gid=".fieldmapping"
          savestate="size">
    <body>
      <list name="fieldmapping" height="1pr">
        <column name="name" type="text" width="2pr" tree="true" />
        <column name="type" type="text" />
        <column name="valuetype" type="text" />
        <column name="definedby" type="text" width="3pr" />
      </list>
    </body>
  </screen>

</screens>

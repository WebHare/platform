---
# yaml-language-server: $schema=http://json-schema.org/draft-07/schema#
# (To update derived the TypeScript interfaces: wh update-generated-files --only=schema - TODO generate TS for us)
# TODO we leave some parts open now to allow for custom elements... but we should be able to compile to a copmlete schema allowing only supported elements
"$schema": http://json-schema.org/draft-07/schema#
title: Site profile
type: object
additionalProperties: false
properties:
  gid:
    type: string
  typeGroup:
    type: string
  types:
    type: object
    additionalProperties: false
    patternProperties:
      "^[a-z][a-zA-Z0-9]*$": # Explicitly not permitting underscores, expecting camelcase. TODO allow URIs too
        $ref: "#/definitions/Type"
        additionalProperties: false
  apply:
    type: array
    items:
      $ref: "#/definitions/Apply"

definitions:
  Type:
    type: object
    additionalProperties: false
    properties:
      namespace:
        type: string
        description: "The namespace assigned to the type. If not set, it will be `x-webhare-scopedtype:module.type_group.type` (snake-cased)"
      gid:
        type: string
      title:
        type: string
      tid:
        type: string
      members:
        $ref: "#/definitions/TypeMembers"

  TypeMembers:
    type: object
    additionalProperties: false
    patternProperties:
      "^[a-z][a-zA-Z0-9]*$": # Explicitly not permitting underscores, expecting camelcase
        $ref: "#/definitions/TypeMember"
        additionalProperties: false

  TypeMember:
    type: object
    additionalProperties: false
    required:
      - "type"
    properties:
      type:
        type: string
        enum:
          - string
          - integer
          - datetime
          - file
          - boolean
          - float
          - money
          - whfsref
          - array
          - whfsrefarray
          - stringarray
          - richdocument
          - intextlink
          - instance
          - url
          - composeddocument
          - record
          # - formcondition  FIXME is this really declarable?
      tid:
        type: string
      title:
        type: string
      members: # TODO limit to arrays only
        $ref: "#/definitions/TypeMembers"

  Apply:
    type: object
    additionalProperties: false
    required:
      - to
    properties:
      to:
        $ref: "#/definitions/ApplyTo"
      baseProps:
        $ref: "#/definitions/ApplyBaseProps"
      editProps:
        $ref: "#/definitions/ApplyEditProps"

  ApplyTo:
    anyOf:
      - type: object
        additionalProperties: false
        required: [type]
        properties:
          type: # should map to scopedType and be resolved
            type: string
          fileType: #'legacy' types - note that these in HS matching also support wildcards
            type: string
          folderType: #'legacy' types - note that these in HS matching also support wildcards
            type: string
      - type: string
        enum:
          - "all"

  ApplyBaseProps:
    type: array
    items:
      type: string
      enum:
        - description
        - keywords
        - seotitle

  ApplyEditProps:
    type: array
    items:
      type: object
      additionalProperties: false
      required: [type]
      properties:
        type:
          type: string
        members:
          type: array
          items:
            type: string

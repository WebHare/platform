managedServices:
  apprunner:
    script: mod::system/scripts/internal/apprunner.whscr
    run: always
  tollium-wasm-runner:
    script: mod::tollium/scripts/internal/applicationstarter.whscr
    run: on-demand
    engine: wasm
  nodeservices: # Implements JS-based <backendservice>s
    script: js/nodeservices/nodeservices.ts
    run: always

backendServices:
  openapiservice:
    clientFactory: "mod::system/js/internal/openapi/openapiservice.ts#getServiceInstance"
  jsrouterservice:
    clientFactory: "mod::system/js/internal/webserver/jsrouterservice.ts#getJSRouter"
  fetchpool:
    clientFactory: "mod::system/js/internal/fetchpool/fetchpool.ts#getFetcher"
  jsonapicaller:
    clientFactory: "mod::system/js/internal/jsonrpccaller.ts#getJSONApiCaller"
  unifiedcache:
    clientFactory: js/cache/imgcache.ts#getUnifiedCacheServer
  assetpacks:
    controllerFactory: js/assetpacks/control.ts#createAssetPackManager
  configuration:
    controllerFactory: js/configure/configservice.ts#createConfigManager
    coreService: true

selfChecks:
  - checker: js/checks/servicechecks.ts#checkMissingServices
  - checker: js/assetpacks/checks.ts#checkAssetPacks

assetPacks:
  pwaserviceworker:
    entryPoint: webfeatures/pwaserviceworker/pwaserviceworker
    supportedLanguages: [en]
    whPolyfills: false
  tollium:
    entryPoint: mod::tollium/webdesigns/webinterface/webinterface
    supportedLanguages: [en, nl]
    whPolyfills: false #tollium shouldn't be recompiled by webserver list changes
  authormode:
    entryPoint: mod::publisher/webdesigns/authormode/authormode.tsx
    supportedLanguages: [en, nl]
    whPolyfills: false #we shouldn't polyfill with this assetpack, we're loaded side-by-side to an existing one
  testsuite:
    entryPoint: mod::system/web/systemroot/jstests/testsuite.tsx
    supportedLanguages: [en]
    whPolyfills: false #actually no platform assetpacks should every be recompiled by webservices list changes

webFeatures:
  identityprovider:
    siteProfile: webfeatures/identityprovider/identityprovider.siteprl.xml

moduleFileTypes:
  - tsType: ModuleDefinition
    schema: data/schemas/moduledefinition.schema.yml
    resourceMask: ^mod::[^/]+/moduledefinition\.yml$
  - tsType: SiteProfile
    schema: data/schemas/siteprofile.schema.yml
    resourceMask: siteprl\.yml$
    contentValidator: mod::publisher/lib/internal/siteprofiles/parser.ts#validateSiteProfile

pxlEvents:
  # Form events need to correspond with FormAnalyticsEventData in @webhare/forms/src/types.ts
  form_started: # 'started' is currently the most minimal event, so we'll use it as the base for others
    fields:
      formmeta_id: string
      formmeta_session: string
      formmeta_pagenum: number
      formmeta_pagetitle: string
      formmeta_time: number
      formmeta_waittime: number
  form_failed:
    includeFields: form_started
    fields:
      formmeta_errorfields: string
      formmeta_errorsource: string
  form_exception:
    includeFields: form_started
    fields:
      formmeta_exception: string
      formmeta_errorsource: string
  form_slow:
    includeFields: form_started
    fields:
      formmeta_waitfor: string
  form_nextpage:
    includeFields: form_started
    fields:
      formmeta_targetpagenum: number
      formmeta_targetpagetitle: string
  form_previouspage:
    includeFields: form_nextpage
  form_submitted:
    includeFields: form_started

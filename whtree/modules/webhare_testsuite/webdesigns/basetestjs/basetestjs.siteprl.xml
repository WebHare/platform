<siteprofile xmlns="http://www.webhare.net/xmlns/publisher/siteprofile">

  <!-- Global site settings -->
  <apply>
    <to type="all" />

    <!-- Setup default webdesign -->
    <webdesign designfolder="."
               maxcontentwidth="960px"
               witty="frontend/frontend.witty"
               getdata="webdesign/webdesign.ts#getBaseTestJSDesign"
               assetpack="basetestjs"
               wittyencoding="HTML-NI"
               async="true" />

    <!-- Set up a rtdtype -->
    <rtddoc rtdtype="http://www.webhare.dev/xmlns/basetestjs/defaultrtdtype" />

    <!-- Configure widgets -->
    <videowidget />

    <!-- Republish all files upon every change
    <republish folder="/" indexonly="false" recursive="true" />
    -->

    <!-- Enable formsapi
         To enable (google) recaptcha, add: usecaptcha="1"
    -->
    <formintegration />

    <!-- disable keywords field -->
    <baseproperties keywords="false" />

    <!-- Default types -->
    <denyfiletype typedef="*" />
    <allowfiletype typedef="http://www.webhare.net/xmlns/publisher/imagefile" />
    <allowfiletype typedef="http://www.webhare.net/xmlns/publisher/pdffile" />
    <!--
    <allowfiletype typedef="http://www.webhare.net/xmlns/publisher/externallink" />
    <allowfiletype typedef="http://www.webhare.net/xmlns/publisher/internallink" />
    <allowfiletype typedef="http://www.webhare.net/xmlns/publisher/contentlink" />
    -->
    <allowfiletype typedef="http://www.webhare.net/xmlns/publisher/richdocumentfile" />
    <allowfiletype typedef="http://www.webhare.net/xmlns/publisher/formwebtool" />

    <denyfoldertype typedef="*" />
    <allowfoldertype typedef="http://www.webhare.net/xmlns/publisher/normalfolder" />

    <!-- Downloadable Word docs -->
    <allowfiletype typedef="http://www.webhare.net/xmlns/publisher/msworddownload" />
    <uploadtypemapping mimetypemask="application/msword" filetype="http://www.webhare.net/xmlns/publisher/msworddownload" />
    <uploadtypemapping mimetypemask="application/vnd.openxmlformats-officedocument.wordprocessingml.document" filetype="http://www.webhare.net/xmlns/publisher/msworddownload" />

    <!-- wrdauth tests
         -->
    <wrdauth xmlns="http://www.webhare.net/xmlns/wrd"
             wrdschema="webhare_testsuite:testschema"
             cookiename="webharelogin-wrdauthjs"
             customizer="webdesign/auth.ts#TestAuthCustomizer"
             lastloginfield="whuser_lastlogin"
             loginpage="currentsite::/portal1/" /> <!-- TODO? supportobjectname="pages/wrdauthtest/wrdauthtest.whlib#WRDAuthSupport" -->

    <!-- Test a plugin -->
    <gtm account="GTM-TN7QQM" integration="selfhosted" launch="pagerender" />

    <!-- shared for now -->
    <formdefinitions path="../basetest/pages/formtest/formtest.formdef.xml" />

    <!-- also load through a name to test that this name doesn't appear in the formid -->
    <formdefinitions name="webhare_testsuite:formdefs" path="../basetest/pages/formtest/formtest.formdef.xml" />
    <formdefinitions name="webhare_testsuite:global" path="../basetest/pages/formtest/global.formdef.xml" />

  </apply>

  <apply>
    <to type="file"  pathmask="/testpages/formtest"/>
    <sitelanguage lang="nl" />
  </apply>

  <apply>
    <to type="folder" />
    <folderindex indexfile="newfile"
                 newfiletype="http://www.webhare.net/xmlns/publisher/richdocumentfile"
                 newfilename="index"
                 />
  </apply>

  <apply>
    <to type="file" pathmask="/testpages/wrdauthtest*multisite*" />
    <wrdauth xmlns="http://www.webhare.net/xmlns/wrd"
             customizer="pages/wrdauthtest.backend.ts#MultisiteCustomizer"
             cookiename="webharelogin-js-multisite"/>
  </apply>

  <apply>
    <to type="all" pathmask="/testpages/wrdauthtest-router-protected/*" />
    <wrdauth xmlns="http://www.webhare.net/xmlns/wrd" loginpage="currentsite::/testpages/wrdauthtest-router" />
  </apply>

  <apply>
    <to type="all" pathmask="/testpages/wrdauthtest-*router-extended" />
    <to type="all" pathmask="/testpages/wrdauthtest-*router-broken" />
    <wrdauth xmlns="http://www.webhare.net/xmlns/wrd"
             authpageswitty="witty/basetest-authpages.witty"
             routerfeatures="emailchange passwordchange" />
  </apply>

  <apply>
    <to type="file" pathmask="*-ps-af*" />
    <sitelanguage lang="ps-AF" />
  </apply>

  <apply>
    <to type="file" pathmask="*-en-gb" />
    <sitelanguage lang="en-GB" />
  </apply>

  <apply>
    <to type="file" pathmask="*-nl*" />
    <sitelanguage lang="nl" />
  </apply>

  <apply>
    <to type="file" pathmask="*-jsrendered*" />
    <bodyrenderer renderer="pages/jsrendered.ts#renderJSPage" />
  </apply>

  <!-- Use a separate schema for the OIDC authenticated portal -->
  <apply>
    <to type="all" pathmask="/portal1-oidc/*" />
    <portal xmlns="http://www.webhare.net/xmlns/tollium"/>
    <wrdauth xmlns="http://www.webhare.net/xmlns/wrd"
             wrdschema="webhare_testsuite:oidc-sp"
             loginpage="currentsite::/portal1-oidc/"
             supportobjectname="compatibility.whlib#WRDAutOIDCSupport"
             customizer="pages/wrdauthtest.backend.ts#OIDCTestCustomizer"
             cookiename="webharelogin-portal1-oidc"
             lastloginfield="whuser_lastlogin" />
  </apply>

  <!-- Activate our YML counterpart -->
  <applysiteprofile path="./basetestjs.siteprl.yml" />

  <!-- Other siteprofile imports (applysiteprofile) must always be at end of this primary siteprofile -->
  <applysiteprofile path="frontend/rtd/rtd.siteprl.xml" />

  <sitesettings>
    <webruleset xmlns="http://www.webhare.net/xmlns/system/moduledefinition">
      <webrule path="/" match="initial"> <!-- A nice initial security policy - better to remove than having to add later -->
        <addheader header="X-Frame-Options" value="DENY"/>
        <addheader header="X-XSS-Protection" value="1; mode=block"/>
        <addheader header="X-Content-Type-Options" value="nosniff"/>
        <addheader header="Referrer-Policy" value="strict-origin-when-cross-origin"/>
        <addheader header="Feature-Policy" value="geolocation 'none'; camera 'none'; payment 'none'; microphone 'none'"/>
        <csp policy="script-src 'self' www.google.com www.gstatic.com; frame-ancestors 'self' [webhare]" />
      </webrule>
      <openapi path="/testsuiteportal/.wh/api/v1/" service="platform:api" />
     <webrule path="/testpages/wrdauthtest-router-protected/accessruleprotected"
               match="initial"
               authmode="ipandaccess"
               authscript="lib/webhare-auth-fromurl.whscr"
               requirewhaccount="true" />
    </webruleset>
  </sitesettings>

</siteprofile>

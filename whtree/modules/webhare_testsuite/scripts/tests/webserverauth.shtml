<?wh
LOADLIB "mod::system/lib/webserver.whlib";
LOADLIB "mod::system/lib/internal/webserver/auth.whlib";
LOADLIB "mod::system/lib/webserver/auth.whlib";

SWITCH(GetWebVariable("authdo"))
{
  CASE "authonce"
  {
    RETURN;
  }
  CASE "createauthsession"
  {
    STRING sess := CreateWebSession("", [x:=42], 90, TRUE);
    UpdateWebCookie("webharelogin", sess, DEFAULT RECORD);
    RETURN;
  }
  CASE "permauthsession"
  {
    AuthenticateWebSession(GetWebCookie("webharelogin"), "", "user", TRUE, 0, 0, TRUE);
    RETURN;
  }
  CASE "requirehttplogin"
  {
    STRING usr := RequireHTTPLogin("testrealm", [[ username := "user1", password := "firstpassword" ]
                                                ,[ username := "user1", password := "secondpassword" ]
                                                ,[ username := "user2", passwordkey := "webhare_testsuite.tests.hashedpassword" ]
                                                ]);
    Print(usr||'\n');
    RETURN;
  }
}

AddHTTPHeader("Status","401",FALSE);

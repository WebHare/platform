# Old array version as expected by 5.3, uncomment if you need to test backendhook conversion
# backendhooks: # Where this extension hooks into the backend
#- tag: testsitehook
#  screen: "platform:siteproperties"
#  tabsextension: tests/publisher/tollium/data/backendhooks.xml#extrasitefields

backendHooks: # Where this extension hooks into the backend
  testsitehook:
    screen: "platform:siteproperties"
    tabsExtension: tests/publisher/tollium/data/backendhooks.xml#extrasitefields
  adduserrights1:
    screen: "platform:userrights"
    addActions:
      - title: "WH testsuite: Add export"
        category: export
        onExecute: tests/publisher/tollium/data/backendhooks.whlib#AddExport
  adduserrights2:
    screen: "platform:userrights"
    when:
      wrdSchema: "wrd:testschema"
    addActions:
    - title: "WH testsuite: testschema"
      category: export
      onExecute: tests/publisher/tollium/data/backendhooks.whlib#AddExport2
  adduserrights3:
    screen: "platform:userrights"
    when:
      wrdSchema: "system:usermgmt"
    addActions:
    - title: "WH testsuite: usermgmt schema"
      category: export
      onExecute: tests/publisher/tollium/data/backendhooks.whlib#AddExport3
  adduserright43:
    screen: "platform:userrights"
    addActions:
    - title: "Should Not Be seen"
      category: export
      onExecute: tests/publisher/tollium/data/backendhooks.whlib#AddExport4
    ifWebHare: # test-backend-hooks.whscr tests whether this backendHook is ignored
      envVars:
        - NEVERSET=1

backendServices:
  demoservice:
    clientFactory: js/demoservice.ts#openDemoService
  controlleddemoservice:
    controllerFactory: js/demoservice.ts#createDemoMain

openApiServices:
  testservice:
    spec: tests/wh/webserver/remoting/openapi/testservice.yaml
  extendedservice:
    spec: tests/wh/webserver/remoting/openapi/testservice.yaml
    # TODO throw in a merge too
    initHook: tests/wh/webserver/remoting/openapi/hooks.ts#extendTheService
    handlerInitHook: tests/wh/webserver/remoting/openapi/hooks.ts#extendTheHandler
  authtests:
    spec: tests/wh/webserver/remoting/openapi/authtests.yaml
    crossDomainOrigins:
      - example.*
      - https://webhare.dev:1234

selfChecks:
  - checker: tests/system/modules/data/checker.ts#runTestsuiteCheck

assetPacks:
  basetestjs:
    entryPoint: webdesigns/basetestjs/frontend/frontend
    supportedLanguages: [en, nl, ps]
  treeshaketest: # FIXME for this test, just adhoc create assetpacks like the testfw do, and implictly import all frontend libs
    supportedLanguages: [en, nl, ps]
    entryPoint: js/treeshaketest.tsx
  iframetest:
    entryPoint: js/iframetest.ts
    supportedLanguages: [en, nl]
    whPolyfills: false

siteProfiles:
  - path: data/wts.siteprl.yml
  - path: tests/consilio/data/consiliotests.siteprl.xml

webFeatures:
  testfeature:
    title: "WH testsuite: Test feature"
    siteProfile: webfeatures/testfeature.siteprl.xml
    hidden: true
  insecure_interface:
    title: "WH testsuite: Unprotected WebHare backend"
    siteProfile: webfeatures/insecure_interface.siteprl.xml
    hidden: true
  siteprl_datastorage:
    title: "WH testsuite: siteprl_datastorage"
    siteProfile: webfeatures/siteprl_datastorage.siteprl.xml
    hidden: true
  siteprl_datastorage2:
    title: "WH testsuite: siteprl_datastorage2"
    siteProfile: webfeatures/siteprl_datastorage2.siteprl.xml
    hidden: true
  conversionstest:
    title: "WH testsuite: conversionstest"
    siteProfile: webfeatures/conversionstest.siteprl.xml
    hidden: true
  actions:
    title: "WH testsuite: actions"
    siteProfile: webfeatures/actions.siteprl.xml
    hidden: true
  unusedfeature:
    title: "WH testsuite: never used feature"
    siteProfile: webfeatures/neverused_feature.siteprl.xml
    hidden: true

moduleFileTypes:
  - resourceMask: ^mod::webhare_testsuite/.*\.test\.yml$
    schema: data/schemas/test.schema.yml
    contentValidator: tests/system/modules/data/validator.ts#validateTestFile
    tsType: TestSchemaType

wrdSchemas:
  jsschema:
    abstract: true
    schema: tests/wrd/data/js-auth.wrdschema.xml
  oidcschema:
    abstract: true
    schema: tests/wrd/nodejs/data/usermgmt_oidc.wrdschema.xml

pxlEvents:
  aa:
    fields:
      s: keyword
      n: integer
      b: boolean
  event: {}
  testevent:
    includeFields: aa

rpcServices:
  testapi:
    filter: js/rpcservice.ts#filterAPI
    api: js/rpcservice.ts#testAPI
  authtestsupport:
    api: tests/wrd/auth/authtestsupport.ts#authTestSupportRPC

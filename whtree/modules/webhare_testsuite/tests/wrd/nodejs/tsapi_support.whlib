<?wh

LOADLIB "wh::files.whlib";
LOADLIB "wh::filetypes/richdocument.whlib";

LOADLIB "mod::wrd/lib/api.whlib";


PUBLIC MACRO SetTestRichDocumentField(STRING wrdschemaname, INTEGER person, STRING html)
{
  OBJECT myrichdoc := NEW RichDocument;
  myrichdoc->ImportFromRecord([ htmltext := StringToBlob(html) ]);

  OpenWRDSchema(wrdschemaname)->^wrd_person->UpdateEntity(person,
      [ richie := myrichdoc->ExportAsRecord()
      ]);
}

PUBLIC RECORD FUNCTION GetTestRichDocumentField(STRING wrdschemaname, INTEGER person)
{
  RETURN OpenWRDSchema(wrdschemaname)->^wrd_person->GetEntityField(person, "richie");
}

PUBLIC STRING ARRAY FUNCTION GetWRDTypeEventMasks(STRING wrdschemaname, STRING typetag)
{
  RETURN OpenWRDSchema(wrdschemaname)->__GetTypeByTag(typetag)->GetEventMasks();
}


PUBLIC RECORD FUNCTION GetWRDEntityFields(STRING wrdschema, STRING type, INTEGER entityid, STRING ARRAY fields)
{
  RETURN OpenWRDSchema(wrdschema)->__GetTypeByTag(type)->GetEntityFields(entityid, fields);
}

PUBLIC MACRO UpdateWRDEntity(STRING wrdschema, STRING type, INTEGER entityid, RECORD updates)
{
  OpenWRDSchema(wrdschema)->__GetTypeByTag(type)->UpdateEntity(entityid, updates);
}

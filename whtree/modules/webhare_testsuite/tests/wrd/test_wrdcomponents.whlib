<?wh
LOADLIB "mod::tollium/lib/screenbase.whlib";
LOADLIB "mod::wrd/lib/screenbase.whlib";

STRING ARRAY orders := ["zero","one","two","three","four","five"];

PUBLIC OBJECTTYPE TestRunQuery EXTEND TolliumScreenBase
<
  MACRO Init(RECORD data)
  {

  }
>;

PUBLIC OBJECTTYPE TestEntitiesEdit EXTEND TolliumScreenBase
<
  MACRO GotChangeOrder(OBJECT wrdtype, INTEGER ARRAY rowkeys)
  {
    OBJECT work := this->BeginUnvalidatedWork();
    FOREVERY (INTEGER rowkey FROM rowkeys)
      wrdtype->UpdateEntity(rowkey, [ wrd_ordering := #rowkey + 1 ]);
    work->Finish();
  }
>;

PUBLIC STATIC OBJECTTYPE EditEntity2 EXTEND WRDEntityEditScreenBase
<
  UPDATE MACRO Init(RECORD data)
  {
    ^entity->RegisterVirtualCell("wrd_title", PTR this->GetTitle, PTR this->SetTitle);
    WRDEntityEditScreenBase::Init(data);
  }
  RECORD FUNCTION OnEntityLoad(RECORD original)
  {
    RETURN CELL[ ...original, ordering := orders[original.wrd_ordering], DELETE wrd_ordering];
  }
  RECORD FUNCTION OnEntityStore(RECORD original)
  {
    RETURN CELL[ ...original, wrd_ordering := SearchElement(orders, original.ordering), DELETE ordering];
  }
  STRING FUNCTION GetTitle()
  {
    RETURN Tokenize(^mytitle->value, ";")[0];
  }
  MACRO SetTitle(STRING value)
  {
    ^mytitle->value := value || "; virtualcell";
  }
>;

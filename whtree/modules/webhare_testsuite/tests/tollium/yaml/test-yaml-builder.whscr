<?wh

LOADLIB "mod::system/lib/testframework.whlib";

LOADLIB "mod::tollium/lib/testframework.whlib";
LOADLIB "mod::tollium/lib/yamlcomponents.whlib";

ASYNC MACRO TestYamlInlineScreens()
{
  AWAIT ExpectScreenChange(+1, PTR RunYamlInlineScreen(GetTestController(),
     CELL[ body_lines :=
           [[ textedit :=
               [ title := "My textedit", value := "Hello, world!" ]]]
         ]));

  TestEq("Hello, world!", TT(":My textedit")->value);

  AWAIT ExpectScreenChange(-1, PTR TTEscape);
}

ASYNC MACRO TestConditions()
{
  AWAIT ExpectScreenChange(+1, PTR RunYamlScreen(GetTestController(), Resolve("data/basics.screens.yml#conditions")));

  TestEq(TRUE, TT(":Text edit")->AllowExternalUpdates());
  TestEq(TRUE, TT("cb_text_edit")->value);
  AWAIT ExpectScreenChange(-1, PTR TTEscape);
}

RuntestFramework([
  PTR TestYamlInlineScreens,
  PTR TestConditions
  ]);

<?xml version="1.0" encoding="UTF-8"?>
<module xmlns="http://www.webhare.net/xmlns/system/moduledefinition">

  <meta configscreen="sysmgmt.homepage">
    <version>1.0.0</version>
    <description>De Digitale site</description>
    <packaging download="true" requireversion="42401">
      <dependency module="socialite" />
      <dependency module="newsletter" requireversion="^4.0.1" />
      <dependency module="webpack" />

      <unixpermissions path="data/stunnel/stunnel.sh" permissions="0755" />

      <excludepath mask="*localtests*" />
    </packaging>
  </meta>

  <portal>
    <applicationgroup name="siteapps" orderbefore="system:cms" tid="testtids.gid1.gid2.title" />

    <application name="woonvinder" group="siteapps" screen="woonvinder.main" tid="testtids.gid1.gid2.title">
      <accesscheck>
        <requireright right="wpkooprights" />
      </accesscheck>
    </application>
    <application name="usermgmt" group="siteapps" screen="usermgmt.main" tid="testtids.gid1.gid2.subtitle">
      <accesscheck>
        <requireright right="system:sysop" />
      </accesscheck>
    </application>
  </portal>

  <publisher>
    <webdesign name="dwp2017" siteprofile="rewritesiteprofile.basics.out.xml" title="De site: Corporate site">
      <assetpack entrypoint="webdesigns/dwp2017/src/index.es" supportedlanguages="nl" />
    </webdesign>
    <webdesign name="wpkoop" siteprofile="rewritesiteprofile.editfragment.out.xml" title="De site: Koopwoningen" />

    <webfeature name="dwplogin"
                siteprofile="rewritesiteprofile.propertyeditor.out.xml"
                title="DWP ActiveDirectory login"
                webdesignmasks="tollium:webinterface" />

    <formcomponents namespace="http://www.desite.net/xmlns/forms" xmlschema="data/formdef.xsd" />
  </publisher>

  <servicemanager>
    <task runat="15,45 * * * *" runtz="Europe/Amsterdam" script="scripts/tasks/dummy.whscr" tag="import_ogekenmerken" description="Importeer OGE-kenmerken" minservertype="test" timeout="120" />
    <task runat="4,16,28,40,52 * * * *" runtz="Europe/Amsterdam" script="scripts/tasks/dummy.whscr" tag="import_woningen" description="Importeer huurwoningen naar de website" timeout="120" />
    <task runat="15 6 * * *" runtz="Europe/Amsterdam" script="scripts/tasks/dummy.whscr" tag="maintenance_task" />
    <task runat="20 6,14,22 * * *" runtz="Europe/Amsterdam" script="scripts/tasks/dummy.whscr" tag="maintenance_task2" />

    <!-- note: runatstartup tasks also run at module push, which is ideal for us -->
    <runatstartup script="scripts/tasks/dummy.whscr" />

    <managedtask type="pdfmailflow" library="formcomponents/pdfmailflow.whlib" objectname="PDFMailFlowTask" />
    <managedtask type="dms_acceptatie" library="lib/tasks/woningacceptatie.whlib" objectname="DMSAcceptatieTask" />
  </servicemanager>

  <services>
    <apprunnerconfig configfunction="getapprunnerconfig" library="internal/support.whlib" />

    <webservice name="woonvinder"
                library="internal/rpc.whlib"
                prefix="rpc_"
                primarytrans="auto"
                transports="jsonrpc whremoting">
      <accesscheck />
    </webservice>
    <webservice name="klantportaal"
                library="internal/klantportaal.whlib"
                prefix="rpc_"
                primarytrans="auto"
                transports="jsonrpc whremoting">
      <accesscheck />
    </webservice>
    <webservice name="rpc"
                library="mod::site_digitaal/webdesigns/dwp2017/lib/rpc.whlib"
                prefix="rpc_"
                primarytrans="auto"
                transports="jsonrpc">
      <accesscheck />
    </webservice>

    <localservice name="woningapi" library="woningapi.whlib" objectname="siteWoningAPI" reuse="true" />
    <localservice name="siteapi" library="siteapi.whlib" objectname="siteAccountAPI" reuse="true" />

    <check library="internal/checks.whlib" objectname="siteLoginCheck" />
  </services>

  <rights>
    <rightsgroup name="rightsgroup" tid="testtids.gid1.gid2.title" />

    <right name="wpkooprights" rightsgroup="rightsgroup" tid="testtids.gid1.gid2.subtitle">
      <impliedby right="system:sysop" />
    </right>
  </rights>

  <databaseschema xmlns:d="http://www.webhare.net/xmlns/whdb/databaseschema">
    <d:table name="ogekenmerkwaarden" primarykey="id">
      <d:integer name="id" autonumberstart="1">
        <d:documentation>Unique identification</d:documentation>
      </d:integer>
      <d:varchar name="ogenummer" maxlength="64" nullable="false" unique="true" />

      <!-- LOREM IPSUM! -->
      <d:money name="oppervlakte_woonkamer_1" />
      <d:index name="ogenummerindex" columns="ogenummer(32)" unique="true" uppercase="true" />
    </d:table>
  </databaseschema>

  <moduleregistry>
    <obsoletenode name="development" />

    <node name="externals">
      <obsoletekey name="test" />
      <obsoletekey name="server" />
      <string name="username" initialval="someaccount" />
      <string name="password" />
    </node>

    <obsoletenode name="emails_tuinonderhoud" />
    <obsoletenode name="emails_nieuweprojecten" />
  </moduleregistry>

  <backend>
    <webrule handlebydir="web/public/" match="initial" path="allroots:/.site_digitaal/" />
  </backend>

  <wrdschemas xmlns="http://www.webhare.net/xmlns/wrd/schemadefinition">
    <schema name="site_digitaal:website" autocreate="true" definitionfile="data/site.wrdschema.xml" originalname="site website" />
  </wrdschemas>

  <newsletter xmlns="http://www.webhare.net/xmlns/newsletter/module">
    <account autocreate="true" tag="dwp_othermails" title="site overige mails" wrdschema="newsletter:site">
      <mailtype generator="mod::site_digitaal/newsletters/standaardmail/standaardmail.whlib#GenerateMailing"
                language="nl"
                profile="mod::site_digitaal/newsletters/standaardmail/standaardmail.prl"
                tag="defaultmail"
                title="site" />
    </account>
    <account autocreate="true" tag="servicemails" title="site servicemails" wrdschema="site_digitaal:website">
      <mailtype language="nl" tag="defaultmail" title="Standaardmailing" />
    </account>
  </newsletter>

</module>

<?wh
LOADLIB "wh::promise.whlib";

PUBLIC INTEGER FUNCTION Add(INTEGER lhs, INTEGER rhs)
{
  RETURN lhs + rhs;
}
PUBLIC ASYNC FUNCTION MultiplyPromise(INTEGER lhs, INTEGER rhs)
{
  AWAIT CreateSleepPromise(20);
  RETURN lhs * rhs;
}

OBJECTTYPE ObjType
<
  PUBLIC STRING FUNCTION Test()
  {
    RETURN "ok";
  }
>;

OBJECT obj;

PUBLIC OBJECT FUNCTION GetObject(INTEGER sleepmsecs)
{
  IF (NOT ObjectExists(obj))
    obj := NEW ObjType;
  Sleep(sleepmsecs);
  RETURN obj;
}

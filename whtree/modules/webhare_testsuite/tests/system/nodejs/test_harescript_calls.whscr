<?wh
LOADLIB "wh::internal/testfuncs.whlib";
LOADLIB "wh::javascript.whlib";

LOADLIB "mod::system/lib/configure.whlib";

OBJECT std := ImportJs("@webhare/std");
TestEqLike("????????-????-????-????-????????????", std->GenerateRandomId("uuidv4"));

OBJECT imp := ImportJs(Resolve("data/calls.ts"));
TestEq(imp, ImportJs(Resolve("data/calls.ts")), "should simply be the same object so callers don't have to bother centrally keeping refs");

TestEq(imp, ImportJs("./data/calls.ts"), "ImportJs should not require Resolve a long as you make clear the path is relative");
TestEq(imp, ImportJs("../nodejs/data/calls.ts"), "ImportJs should not require Resolve a long as you make clear the path is relative (2)");

OBJECT promise42 := imp->testAsync42();
TestEq(43, imp->testSync43());
TestEq(42, WaitForPromise(promise42));

STRING randomonce := imp->getOnceRandom();
STRING randomtwice := imp->getOnceRandom();
TestEq(randomonce, randomtwice, "Should be equal as we expect ImportJS to cache loaded lib instances");

TestEq(GetProcessInfo().pid, ImportJS("process")->_get(IsWasm() ? "pid" : "ppid"));

<?wh
LOADLIB "wh::files.whlib";
LOADLIB "wh::xml/xsd.whlib";
LOADLIB "mod::system/lib/testframework.whlib";
LOADLIB "wh::internet/webbrowser.whlib";

LOADLIB "mod::webhare_testsuite/lib/system/tests.whlib";


PUBLIC MACRO SetupSite()
{
  testfw->BeginWork();
  OBJECT testfile := GetTestsuiteTempFolder()->CreateFile([name:="opengraph.html", data := StringToBlob("Een <b>test</b> pagina"), publish := TRUE, type := 5 ]);
  testfw->CommitWork();
  testfw->WaitForPublishCompletion(GetTestsuiteTempFolder()->id);

  OBJECT browser := NEW WebBrowser;
  TestEq(TRUE, browser->GotoWebpage(testfile->link), testfile->link);

  STRING ARRAY prefixes := ParseXSList(browser->document->documentelement->GetAttribute("prefix"));
  TestEq(TRUE,Length(prefixes)>0, browser->url);
  INTEGER ogpos := SearchElement(prefixes,'og:');
  TestEq(TRUE, ogpos != -1);
  TestEQ('http://ogp.me/ns#', prefixes[ogpos+1]);
}

RunTestFramework( [ PTR SetupSite
                  ]);

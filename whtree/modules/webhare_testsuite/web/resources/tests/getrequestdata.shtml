<?wh
LOADLIB "wh::files.whlib";

LOADLIB "mod::system/lib/webserver.whlib";


RECORD data :=
    [ localport :=        GetClientLocalPort()
    , localaddress :=     GetClientLocalAddress()
    , localip :=          GetClientLocalIP()
    , remoteport :=       GetClientRemotePort()
    , remoteip :=         GetClientRemoteIP()
    , clienturl :=        GetClientRequestURL()
    , clientbinding :=    GetClientBinding()
    , serverurl :=        GetRequestURL()
    , headers :=          GetAllWebHeaders()
    , body :=             GetRequestBody()
    , method :=           GetRequestMethod()
    ];

IF(GetWebHeader("Accept") = "application/json")
{
  data := CELL[ ...data, body := BlobToString(data.body) ];
  AddHTTPHeader("Content-Type", "application/json", FALSE);
  SendWebFile(EncodeJSONBlob(data));
}

AddHTTPHeader("Content-Type", "application/x-hson", FALSE);
SendWebFile(EncodeHSONBlob(data));

<?wh
/** @short WRD authentication
    @topic wrdauth/api
*/

LOADLIB "mod::publisher/lib/siteprofiles.whlib";

LOADLIB "mod::wrd/lib/internal/auth/legacy-api.whlib" EXPORT WRDAuthSupportBase;
LOADLIB "mod::wrd/lib/internal/userapi.whlib" EXPORT GetWRDAuthUserAPI;
LOADLIB "mod::wrd/lib/internal/auth/support.whlib" EXPORT CreateAuthenticationSettingsFromPasswordHash, GetDefaultAuthenticationSettings, IsDefaultAuthenticationSettings;


/** @short Get the authentication plugin for the specified url
    @long This function looks up the fsobject for the url (using LookupPublisherURL) and then obtains the wrdauth plugin object, if ant
    @param url URL to look up
    @cell options.clientwebserver Id of client webserver, if known
    @return The auth plugin. Throws an exception if no plugin is registered */
PUBLIC OBJECT FUNCTION GetWRDAuthPlugin(STRING url, RECORD options DEFAULTSTO DEFAULT RECORD)
{
  options := ValidateOptions([ clientwebserver := -1 ], options);

  OBJECT wrdauthplugin := GetWebContextForURL(url, options)->GetPlugin("http://www.webhare.net/xmlns/wrd", "wrdauth");
  IF(NOT ObjectExists(wrdauthplugin))
    THROW NEW Exception("No wrdauth plugin registered for URL " || url);

  RETURN wrdauthplugin;
}


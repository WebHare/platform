<screens xmlns="http://www.webhare.net/xmlns/tollium/screens"
         xmlns:wrd="http://www.webhare.net/xmlns/wrd/components"
         library="../lib/screens/commondialogs.whlib">

  <messageboxes gid="commondialogs.messages">
    <messagebox name="delete_entity" buttons="yes no" />
    <messagebox name="entity_in_use" buttons="ok" />
    <messagebox name="no_email_column" buttons="ok" />
  </messageboxes>

  <screen name="entities"
          minwidth="550px"
          minheight="450px"
          allowresize="true"
          allpublic="true"
          flags="can_search_free"
          savestate="position size">
    <actions gid="entities.actions">
      <action name="ok" onexecute="submit" tid="~ok" />
      <action name="cancelaction" onexecute="cancel" tid="~cancel" />
      <action name="close" onexecute="cancel" tid="~close" />
      <action name="add" onexecute="doadd" />
      <action name="edit" onexecute="doedit">
        <enableon source="ents" min="1" max="1" />
      </action>
      <action name="del" onexecute="dodel">
        <enableon source="ents" min="1" max="1" />
      </action>
      <action name="searchfree" frameflags="can_search_free" onexecute="dosearchfree" />
    </actions>

    <menus>
      <menu name="modify">
        <item action="edit" />
        <item action="del" />
      </menu>
      <menu name="emptyspace">
        <item action="add" />
      </menu>
    </menus>

    <compositions>
      <eventlistener name="eventlistener" onevent="onevent" />
    </compositions>

    <body>
      <panel name="freesearchbox" public="true" visible="false">
        <!-- made public for now, clear up API between the various entities users later -->
        <wrd:quickfilter name="quickfilter" onsearch="onquickfiltersearch" />
      </panel>
      <grid width="1pr" height="1pr">
        <col width="1pr" />
        <col />
        <row height="1pr">
          <cell height="1pr">
            <list name="ents"
                  width="1pr"
                  height="1pr"
                  newcontextmenu="emptyspace"
                  openaction="edit"
                  selectcontextmenu="modify"
                  selectmode="single" />
          </cell>
          <cell>
            <panel name="addeditdel">
              <button width="1pr" action="add" />
              <button width="1pr" action="edit" />
              <button width="1pr" action="del" />
            </panel>
          </cell>
        </row>
      </grid>
    </body>

    <footer>
      <line layout="right">
        <button name="okbutton" action="ok" />
        <button name="cancelbutton" action="cancelaction" />
        <button name="closebutton" action="close" />
      </line>
    </footer>
  </screen>

  <screen name="editentity" allpublic="true" footerbuttons="ok cancel" tid="editentity.title">
    <compositions>
      <wrd:entity name="entity" />
    </compositions>

    <body name="body" gid="editentity">
      <!-- Al dit uitgecommente was een poging voor een standaard edit entity scherm, die op basis van type mooie tabbladen
           aanmaakte enzo.

      <tabs name="tabs">
        <tab name="basefields">
          <panel name="general" layout="form" box="true" />
        </tab>
        <tab name="availability">
          <panel name="lifetime" layout="form" box="true">
            <wrd:field entity="entity" field="wrd_creationdate" />
            <select type="radio" name="limittype">
              <option rowkey="nolimit" selected="1" tid="editentity.nolimit" />
              <option rowkey="limit" tid="editentity.limit" />
            </select>
            <datetime type="datetime" precision="minutes" name="ends_at" />
          </panel>
        </tab>
      </tabs>
      -->
      <panel height="1pr">
        <panel name="general" />
        <box name="lifetime">
          <datetime composition="entity"
                    cellname="wrd_creationdate"
                    name="wrd_creationdate"
                    type="datetime"
                    precision="seconds"
                    required="true"
                    storeutc="true" />
          <datetime composition="entity"
                    cellname="wrd_limitdate"
                    name="wrd_limitdate"
                    type="datetime"
                    emptyvalue="max_datetime"
                    precision="seconds"
                    storeutc="true" />
        </box>
      </panel>
    </body>
  </screen>

  <screen name="resultgrid" width="300x" height="40x" allpublic="true" flags="canemail" gid="commondialogs.resultgrid">
    <actions gid="wrd:commondialogs.actions">
      <action name="email_results" frameflags="canemail" onexecute="DoEmail" />
      <action name="export_results" onexecute="DoExport" />
      <action name="run" hint="" onexecute="DoRun" />
      <action name="exportdirect" hint="" onexecute="DoExportDirect" />
    </actions>

    <toolbar>
      <button name="emailbutton" action="email_results" icon="tollium:mailclient/new_message" />
      <button action="export_results" icon="tollium:actions/export" />
    </toolbar>

    <body>
      <panel name="parameters">
        <grid>
          <col />
          <col width="1pr" />
          <row>
            <cell>
              <panel name="fields" layout="form" />
            </cell>
            <cell>
              <panel name="top" height="1pr" />
              <panel name="bottom" layout="right">
                <button action="exportdirect" hint="" tid="commondialogs.resultgrid.exportdirect" />
                <button name="runbutton" action="run" hint="" tid="commondialogs.resultgrid.execute" />
              </panel>
            </cell>
          </row>
        </grid>
      </panel>
      <panel height="1pr">
        <list name="results" height="1pr" />
      </panel>
    </body>
  </screen>

  <screen name="resultexport"
          allpublic="true"
          footerbuttons="ok cancel"
          gid="wrd:commondialogs.resultexport"
          implementation="none">
    <body layout="form">
      <select name="separator" type="pulldown" public="true">
        <option rowkey="semicolon" selected="1" tid=".semicolon" />
        <option rowkey="comma" tid=".comma" />
        <option rowkey="tab" tid=".tab" />
      </select>
      <select name="charset" type="pulldown" public="true">
        <option rowkey="ISO-8859-1" selected="1" title="ISO-8859-1" />
        <option rowkey="UTF-8" title="UTF-8" />
      </select>
    </body>
  </screen>

  <screen name="verificationresult"
          allpublic="true"
          gid="wrd:commondialogs.verificationresult"
          implementation="none"
          tid=".pagetitle">
    <body layout="form">
      <grid>
        <col />
        <col />
        <row>
          <cell>
            <box minwidth="40x" tid=".original">
              <text name="original" title="" />
            </box>
          </cell>
          <cell>
            <box minwidth="40x" tid=".returned">
              <text name="returned" title="" />
            </box>
          </cell>
        </row>
      </grid>
      <box tid=".problems">
        <text name="problems_street" title="" valuetid=".no_street_match" />
        <text name="problems_city" title="" valuetid=".no_city_match" />
      </box>
    </body>

    <footer>
      <line layout="right">
        <button tid=".correct" tolliumresult="overwrite" />
        <button tid="~cancel" tolliumresult="cancel" />
      </line>
    </footer>
  </screen>

  <screen name="editaddress" defaultbutton="okbutton" gid="wrd:commondialogs.editaddress" tid=".pagetitle">
    <actions>
      <action name="checkverify" onexecute="docheckverify" title="" />
    </actions>

    <body>
      <panel name="addresspanel" width="80x" height="20x">
        <!-- ADDME: Remove/reduce width/height when we have resizing dialogs (guess we have little choice) -->
        <select name="country" type="pulldown" onchange="oncountrychange" />
        <wrd:countryfields name="countryfields" />
      </panel>
    </body>

    <footer>
      <line layout="right">
        <button name="btn_verify" action="checkverify" />
        <button name="okbutton" tid="~ok" tolliumresult="ok" />
        <button tid="~cancel" tolliumresult="cancel" />
      </line>
    </footer>
  </screen>

  <screen name="auditlog"
          width="100x"
          height="60x"
          allowresize="true"
          footerbuttons="close"
          gid="wrd:commondialogs.auditlog"
          savestate="position size"
          tid=".title">
    <actions>
      <action name="refresh" onexecute="dorefresh" />
      <action name="showevent" onexecute="doshowevent" title="" />
    </actions>

    <compositions>
      <eventlistener name="auditloglistener" onevents="GotAuditLogEvents" />
    </compositions>

    <body height="1pr">
      <line>
        <datetime name="fromdate" type="datetime" storeutc="true" />
        <datetime name="todate" type="datetime" storeutc="true" />
        <textedit name="filter" defaultbutton="btn_refresh" tid=".filter" />
        <spacer />
        <button name="btn_refresh" action="refresh" tid=".refresh" />
      </line>
      <line layout="left">
        <checkbox name="show_success" labeltid=".show_success" onchange="dorefresh" title="" value="true" />
        <checkbox name="show_warning" labeltid=".show_warning" onchange="dorefresh" title="" value="true" />
        <checkbox name="show_failure" labeltid=".show_failure" onchange="dorefresh" title="" value="true" />
        <checkbox name="show_other" labeltid=".show_other" onchange="dorefresh" title="" value="true" />
      </line>
      <list name="events"
            width="1pr"
            height="1pr"
            icons="tollium:status/positive tollium:status/warning tollium:status/serious_error"
            ongetrows="ongetevents"
            openaction="showevent"
            selectmode="single">
        <column name="wrd_creationdate" type="datetime" width="20x" precision="seconds" storeutc="true" />
        <column name="status" type="icon" />
        <column name="wrdaudit_type" type="text" />
        <column name="wrdaudit_account" type="text" />
        <column name="wrdaudit_login" type="text" />
        <column name="user_account" type="text" />
        <column name="impersonator_account" type="text" />
      </list>
    </body>
  </screen>

  <screen name="auditlogevent"
          width="80x"
          height="35x"
          minheight="35x"
          allowresize="true"
          gid="wrd:commondialogs.auditlog"
          savestate="position size"
          tid=".title">
    <compositions>
      <record name="event" />
    </compositions>

    <body height="1pr">
      <text name="type" tid=".wrdaudit_type" />
      <datetime composition="event"
                cellname="creationdate"
                type="datetime"
                precision="milliseconds"
                readonly="true"
                storeutc="true"
                tid=".wrd_creationdate" />
      <line>
        <text composition="event" cellname="login" name="login" tid=".wrdaudit_account" />
        <textedit composition="event" cellname="entity" name="entity" readonly="true" tid="~id" valuetype="integer" />
      </line>
      <line>
        <text composition="event" cellname="bylogin" name="bylogin" tid=".user_account" />
        <textedit composition="event" cellname="byentity" name="byentity" readonly="true" tid="~id" valuetype="integer" />
      </line>
      <line>
        <text composition="event" cellname="impersonator_login" name="impersonator_login" tid=".impersonator_account" />
        <textedit composition="event"
                  cellname="impersonator_entity"
                  name="impersonator_entity"
                  readonly="true"
                  tid="~id"
                  valuetype="integer" />
      </line>
      <text composition="event" cellname="ip" />
      <text composition="event" cellname="country" />
      <text composition="event" cellname="browsertriplet" tid=".browser" />
      <heading name="dataheading" />
      <panel height="1pr" borders="all">
        <codeedit name="data" height="1pr" enabled="false" />
      </panel>
    </body>
  </screen>

</screens>

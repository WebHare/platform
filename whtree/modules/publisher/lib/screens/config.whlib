<?wh
LOADLIB "mod::tollium/lib/screenbase.whlib";

LOADLIB "mod::system/lib/configure.whlib";


PUBLIC OBJECTTYPE Prefs EXTEND TolliumScreenBase
<
  MACRO Init()
  {
    STRING ARRAY opts;
    IF(this->tolliumuser->GetRegistryKey("publisher.prefs.propsafterupload",FALSE))
      INSERT "propsafterupload" INTO opts AT END;
    IF(this->tolliumuser->GetRegistryKey("publisher.prefs.nouploadrename",FALSE))
      INSERT "nouploadrename" INTO opts AT END;
    IF(this->tolliumuser->GetRegistryKey("publisher.prefs.groupfolders", TRUE))
      INSERT "groupfolders" INTO opts AT END;

    IF(this->tolliumuser->GetRegistryKey("publisher.prefs.showforeignfolders", FALSE))
      INSERT "showforeignfolders" INTO opts AT END;

    IF(this->tolliumuser->GetRegistryKey("publisher.prefs.showmenubar", FALSE))
      INSERT "showmenubar" INTO opts AT END;

    this->opts->value := opts;

    this->autotitles->value := this->tolliumuser->GetRegistryKey("publisher.prefs.autotitles", ReadRegistryKey("publisher.filemgr.defaultautotitles"));

    this->tweaks->visible := this->tolliumuser->HasRight("system:sysop");
    this->showwhfsprivate->value := this->tolliumuser->GetRegistryKey("publisher.filemgr.showwhfsprivate", FALSE);
    this->showwebharebackend->value := this->tolliumuser->GetRegistryKey("publisher.filemgr.showwebharebackend", FALSE);
  }

  BOOLEAN FUNCTION Submit()
  {
    STRING ARRAY opts := this->opts->value;

    IF( (this->showwhfsprivate->value AND NOT this->tolliumuser->GetRegistryKey("publisher.filemgr.showwhfsprivate", FALSE))
        OR (this->showwebharebackend->value AND NOT this->tolliumuser->GetRegistryKey("publisher.filemgr.showwebharebackend",FALSE))
      )
    {
      IF(this->RunMessageBox(".confirmenabletweak")!="yes")
        RETURN FALSE;
    }

    OBJECT work:=this->BeginWork();
    this->tolliumuser->SetRegistryKey("publisher.prefs.propsafterupload", "propsafterupload" IN opts);
    this->tolliumuser->SetRegistryKey("publisher.prefs.nouploadrename", "nouploadrename" IN opts);
    this->tolliumuser->SetRegistryKey("publisher.prefs.groupfolders", "groupfolders" IN opts);
    this->tolliumuser->SetRegistryKey("publisher.prefs.showforeignfolders", "showforeignfolders" IN opts);
    this->tolliumuser->SetRegistryKey("publisher.prefs.showmenubar", "showmenubar" IN opts);
    this->tolliumuser->SetRegistryKey("publisher.prefs.autotitles", this->autotitles->value);

    IF(this->tweaks->visible)
    {
      this->tolliumuser->SetRegistryKey("publisher.filemgr.showwhfsprivate",   this->showwhfsprivate->value);
      this->tolliumuser->SetRegistryKey("publisher.filemgr.showwebharebackend", this->showwebharebackend->value);
    }
    RETURN work->Finish();
  }
>;

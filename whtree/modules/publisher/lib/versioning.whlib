<?wh

LOADLIB "mod::system/lib/whfs.whlib";

LOADLIB "mod::publisher/lib/siteapi.whlib";
LOADLIB "mod::publisher/lib/internal/versioning/helpers.whlib";
LOADLIB "mod::publisher/lib/internal/versioning/policybase.whlib" EXPORT VersioningPolicyBase, VersioningObjectPolicyBase;
LOADLIB "mod::publisher/lib/internal/versioning/support.whlib";
LOADLIB "mod::publisher/tolliumapps/versioning/versioning.whlib";


PUBLIC MACRO RunVersioningApplication(STRING site, OBJECT controller, RECORD appdata)
{
  INSERT CELL sitename := site INTO appdata;
  controller->LoadScreen("mod::publisher/tolliumapps/versioning/versioning.xml#main", appdata)->RunModal();
}

PUBLIC MACRO RunVersionedFileRestore(OBJECT controller, INTEGER deletedfileid)
{
  RECORD versionevent := GetLastVersionApplyEvent(deletedfileid);
  IF (NOT RecordExists(versionevent))
    THROW NEW Exception(`No such deleted file #${deletedfileid}`);

  OBJECT policy;
  THROW NEW Exception("This function is uncallable"); //FIXME
}

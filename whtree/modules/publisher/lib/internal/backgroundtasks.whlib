<?wh

LOADLIB "mod::tollium/lib/backgroundtask.whlib";
LOADLIB "mod::tollium/lib/gettid.whlib";
LOADLIB "mod::publisher/lib/control.whlib";

PUBLIC OBJECTTYPE ScheduleRepublishTask EXTEND TolliumBackgroundTask
<
  STRING mask;
  BOOLEAN nontemplatetoo;
  BOOLEAN recursive;
  BOOLEAN iffailed;
  STRING limittodesign;

  MACRO Init(RECORD data)
  {
    this->mask := data.mask;
    this->nontemplatetoo := data.nontemplatetoo;
    this->recursive := data.recursive;
    this->iffailed := data.iffailed;
    this->limittodesign := data.limittodesign;
  }

  MACRO StatusCallback(FLOAT progress, STRING sitename)
  {
    this->status := [ progress := INTEGER(progress*100)
                    , status := GetTid("publisher:backgroundtasks.schedulerepublishtask.running", sitename)
                    ];
  }

  MACRO Run()
  {
    __DoRepublishByMask(this->mask, this->nontemplatetoo, this->recursive, PTR this->StatusCallback, this->iffailed, this->limittodesign);
    this->result :=
        [ status := "ok"
        ];
  }
>;

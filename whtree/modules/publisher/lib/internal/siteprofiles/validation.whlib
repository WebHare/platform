<?wh
LOADLIB "mod::publisher/lib/internal/siteprofiles/parser.whlib";
LOADLIB "mod::system/lib/resources.whlib";
LOADLIB "mod::tollium/lib/internal/validation.whlib";

PUBLIC OBJECTTYPE SiteprofValidator EXTEND ScreensFileValidator
<
  UPDATE PUBLIC RECORD FUNCTION Validate(OBJECT doc, STRING name, OBJECT xsd)
  {
    RECORD result := ScreensFileValidator::Validate(doc,name,xsd);
    IF(name LIKE "module*")
    {
      FOREVERY(OBJECT node FROM doc->GetElementsByTagNameNS("http://www.webhare.net/xmlns/system/moduledefinition","services")->GetCurrentElements())
      {
        INSERT [ resourcename := name
               , line := node->linenum
               , col := 0
               , message := "Module siteprofiles should not contain service definitions - move your services to the module"
               , code := 0
               ] INTO result.errors AT END;
      }
    }

    RECORD parseres := ParseSiteProfile(name, "", [ xmldoc := doc ]); //ADDME forwards XSD?
    result.errors := result.errors CONCAT SELECT code := 0, col, line, message, resourcename FROM parseres.value.errors;
    result.warnings := result.warnings CONCAT SELECT code := 0, col, line, message, resourcename FROM parseres.value.warnings;
    RETURN result;
  }
>;

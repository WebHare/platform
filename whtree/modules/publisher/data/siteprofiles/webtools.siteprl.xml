<siteprofile xmlns="http://www.webhare.net/xmlns/publisher/siteprofile"
             xmlns:p="http://www.webhare.net/xmlns/publisher/components">

  <!--
  Webtools consists of:

  - Poll
    - database definition
    - file/widget type (serving both as holder/editor for poll data and as widget to preview/publish in RTD's)
    - embeddededitor for the poll file type
    - Webhare API
    - RPC
    - JS API (promise based)
   -->
  <widgettype namespace="http://www.webhare.net/xmlns/publisher/pollwebtool"
              comment='Poll file

    These shared the same rendercode:
    - "http://www.webhare.net/xmlns/publisher/pollwebtool"
    - "http://www.webhare.net/xmlns/publisher/pollwidget"'
              icon="tollium:messageboxes/question"
              renderobjectname="mod::publisher/lib/webtools/internal/renderpoll.whlib#PollWidget"
              searchcontentprovider="publisher:webtoolform"
              tid="filetypes.webtool-poll"
              wittycomponent="mod::publisher/lib/webtools/internal/renderpoll.witty:renderpoll">
    <members>
      <datetime name="allowvotestill" comment="ADDME: implement this option" />
      <boolean name="ismultiplechoice"
               comment='ADDME: (when a customer pays for this) option to specify when results become available

           DEFAULT DATETIME - always
           ...              - from the specified date
                            - after the poll closes
           MAX DATETIME     - never

      &lt;member name="shoresults"     type="datetime" />' />
      <richdocument name="question" />
      <richdocument name="messageaftervoting" />
      <string name="title" />
      <array name="options">
        <string name="guid" comment="GUID used for referencing the option" />
        <string name="title" />
        <boolean name="hide"
                 comment="to make options (for which there already are votes) or to prepare an option to become available later)" />

        <!-- member name="intlink" type="whfsref" -->

        <!-- whfsobject, for other poll option editors to do magic things (experimental for now) -->
      </array>
    </members>
  </widgettype>

  <apply>
    <to type="file" filetype="http://www.webhare.net/xmlns/publisher/pollwebtool" />
    <setobjecteditor screen=".editpoll" />

    <!-- allow voting again after a day (7 * 1440 minutes) -->
    <pollsettings allowvotingagainafter="10080" />
  </apply>

  <!-- ADDME: celledit on the poll might be very nice.
              However in that case we might also want a 'lock' mechanism against accidental edits since 'click-to-edit' is less explicit than
              selection+click an edit button+'ok'.
  -->
  <screen xmlns="http://www.webhare.net/xmlns/tollium/screens"
          name="editpoll"
          width="85x"
          footerbuttons="ok cancel"
          library="/lib/screens/objectprops/webtools-poll.whlib">
    <compositions>
      <p:whfsinstance name="fsobject" typedef="http://www.webhare.net/xmlns/publisher/pollwebtool" />
    </compositions>

    <body gid="webtools.editpoll" spacers="none">
      <!-- datetime at which voting becomes impossible
      <t:datetime cellname="allowvotestill" composition="contentdata" type="datetime" />
      -->
      <tabs height="1pr">
        <tab tid=".tab_question">
          <heading tid=".header_question" />
          <textedit composition="fsobject" cellname="title" />
          <richdocument composition="fsobject" cellname="question" />
          <panel spacers="top bottom">
            <heading tid=".header_options" />
            <line layout="left">
              <checkbox composition="fsobject" cellname="ismultiplechoice" labeltid=".ismultiplechoice" title="" />
            </line>
            <arrayedit composition="fsobject"
                       cellname="options"
                       name="options"
                       height="1pr"
                       minheight="14x"
                       onmaprows="onmapoptionrows"
                       onrowdelete="onrowdelete"
                       orderable="true"
                       roweditscreen=".editpolloption">
              <column name="title" type="text" width="1pr" />
              <column name="votes" type="integer" width="9x" align="right" />
              <style name="hidden" textcolor="#888888" />
            </arrayedit>
            <text name="totalvoters" title="" />
          </panel>
        </tab>
        <tab tid=".tab_aftervoting">
          <heading tid=".header_thanks" />
          <richdocument composition="fsobject" cellname="messageaftervoting" />
        </tab>
      </tabs>
    </body>
  </screen>

  <screen xmlns="http://www.webhare.net/xmlns/tollium/screens"
          name="editpolloption"
          footerbuttons="ok cancel"
          gid="webtools.editpolloption"
          implementation="lib"
          library="/lib/screens/objectprops/webtools-poll.whlib"
          tid=".frametitle_option">
    <compositions>
      <record name="row" />
    </compositions>

    <body>
      <line layout="left">
        <checkbox composition="row" cellname="hide" labeltid=".hide" title="" />
      </line>
      <textarea composition="row" cellname="title" width="40x" height="2x" />
      <textedit composition="row" cellname="guid" readonly="true" title="GUID" visible="false" />
    </body>
  </screen>

  <!--
    Form file
  -->
  <grouptype namespace="http://www.webhare.net/xmlns/publisher/mailwidgets" tid="siteprofile.widgets.mail" />

  <widgettype namespace="http://www.webhare.net/xmlns/publisher/formmergefield"
              editextension="#editmergefield"
              embedtype="inline"
              ingroup="http://www.webhare.net/xmlns/publisher/mailwidgets"
              renderobjectname="mod::publisher/lib/internal/forms/mergefield.whlib#MergeFieldWidget"
              requiremergefieldscontext="true"
              tid="webtools.mergefield.widgettitle">
    <members>
      <string name="fieldname" />
    </members>
  </widgettype>

  <tabsextension xmlns="http://www.webhare.net/xmlns/tollium/screens"
                 name="editmergefield"
                 implementation="lib"
                 library="mod::publisher/lib/internal/forms/mergefield.whlib">
    <newtab gid="webtools.mergefield">
      <select composition="contentdata"
              cellname="fieldname"
              name="fieldname"
              type="pulldown"
              required="true"
              rowkeytype="string" />
    </newtab>
  </tabsextension>

  <widgettype namespace="http://www.webhare.net/xmlns/publisher/formresultsfield"
              comment="This embedded object embeds the form results within the mail. We're not exposing it to all users for now, so the
       form's mailrtdtype should explicity allow this widgettype to use it."
              ingroup="http://www.webhare.net/xmlns/publisher/mailwidgets"
              renderobjectname="mod::publisher/lib/internal/forms/resultsfield.whlib#ResultsFieldWidget"
              requiremergefieldscontext="true"
              tid="webtools.resultsfield.widgettitle">
    <members />
  </widgettype>

  <widgettype namespace="http://www.webhare.net/xmlns/publisher/formconfirmfield"
              editextension="#editconfirmfield"
              embedtype="inline"
              ingroup="http://www.webhare.net/xmlns/publisher/mailwidgets"
              renderobjectname="mod::publisher/lib/internal/forms/confirmfield.whlib#ConfirmFieldWidget"
              requiremergefieldscontext="true"
              tid="webtools.confirmfield.widgettitle">
    <members>
      <string name="linktext" />
    </members>
  </widgettype>

  <tabsextension xmlns="http://www.webhare.net/xmlns/tollium/screens" name="editconfirmfield">
    <newtab gid="webtools.confirmfield">
      <textedit composition="contentdata" cellname="linktext" width="1pr" placeholdertid=".placeholder" />
    </newtab>
  </tabsextension>

  <filetype namespace="http://www.webhare.net/xmlns/publisher/formwebtool"
            kind="virtualfile"
            icon="tollium:files/application_x-webhare-survey"
            initialpublish="false"
            searchcontentprovider="publisher:webtoolform"
            tid="filetypes.webtool-form">
    <members>
      <boolean name="disablecaptcha" />
      <integer name="storeresults"
               comment="Because the default value is 0 and the default should be &quot;use the server default retention period&quot;, the value -1 (or          any value &lt; 0) is used to signify 0 days (don't store at all)" />
      <integer name="maxsignups" />
      <composeddocument name="data" />
      <boolean name="unavailable" />
      <richdocument name="unavailabletext" />
      <record name="fixformoptions"
              comment="archived original remapping in case we ever need it. at some point we can drop this member" />
    </members>
    <dynamicexecution webpageobjectname="mod::publisher/lib/forms/base.whlib#WebtoolFormPage" />
    <setobjecteditor name="publisher:webtoolform" separateapp="true" />
  </filetype>

  <contenttype namespace="http://www.webhare.net/xmlns/publisher/formstats" cloneoncopy="false">
    <datetime name="firstresult" />
    <integer name="numresults" />
  </contenttype>

  <contenttype namespace="http://www.webhare.net/xmlns/publisher/formcondition">
    <record name="data" />
    <record name="fixformoptions"
            comment="archived original condition in case we ever need it. at some point we can drop this member" />
  </contenttype>

  <contenttype namespace="http://www.webhare.net/xmlns/publisher/mailhandlerattachments"
               comment="The contenttype used to store mail handler attachments in an instance">
    <array name="attachments">
      <file name="file" />
    </array>
  </contenttype>

  <widgettype namespace="http://www.webhare.net/xmlns/publisher/formwidget"
              comment="form as widget

       we can't set the standard form as a widget, because we can't control
       the widget preview then"
              renderobjectname="mod::publisher/lib/widgets/formwidget.whlib#FormWidgetBase"
              tid="siteprofile.widgets.formwidget" />

  <apply>
    <to type="file" filetype="http://www.webhare.net/xmlns/publisher/formwidget" />
    <setobjecteditor name="publisher:webtoolform" separateapp="true" />
  </apply>

  <!-- The default type that is used for editing rtd fields -->
  <rtdtype namespace="http://www.webhare.net/xmlns/publisher/rtdfielddefaulttype">
    <blockstyles defaultstyle="NORMAL">
      <textstyle tag="NORMAL" containertag="p" textstyles="b i u a-href" />
    </blockstyles>
  </rtdtype>
</siteprofile>

<siteprofile
   xmlns="http://www.webhare.net/xmlns/publisher/siteprofile"
   xmlns:p="http://www.webhare.net/xmlns/publisher/components"
   xmlns:t="http://www.webhare.net/xmlns/tollium/screens">


  <!-- V2 -->
  <contenttype namespace="http://www.webhare.net/xmlns/blexdev_blit/v2/checkedoutfolder" cloneoncopy="true">
    <member name="repository_url" type="string" />
    <member name="repository_path" type="string" />
    <member name="repository_uuid" type="string" />
    <member name="repository_version" type="integer" />
    <member name="repository_roothash" type="string" />
    <member name="repository_localuuid" type="string" />
    <member name="emptydummyfield" type="string" /> <!-- fixme: added because apply-rule 'testdata' always returns false for new objects. This field must remain empty -->
  </contenttype>

  <contenttype namespace="http://www.webhare.net/xmlns/blexdev_blit/v2/inclusionsettings" cloneoncopy="true">
    <member name="settings" type="array">
      <member name="fsobject" type="whfsref" />
      <member name="self" type="string" />
      <member name="recursive" type="string" />
      <member name="basefields" type="stringarray" />
    </member>
  </contenttype>

  <propertyeditor name="inclusionsettingseditor">
    <compositions>
      <p:whfsinstance name="coffsinstance" typedef="http://www.webhare.net/xmlns/blexdev_blit/v2/checkedoutfolder" />
      <p:whfsinstance name="fsinstance" typedef="http://www.webhare.net/xmlns/blexdev_blit/v2/inclusionsettings" />
    </compositions>
    <newtab gid="editors" tid=".inclusionsettingseditor">
      <t:box tid=".checkedoutfolder">
        <t:textedit composition="coffsinstance" cellname="repository_url" enabled="false" width="1pr" />
        <t:line>
          <t:textedit composition="coffsinstance" cellname="repository_path" enabled="false" width="1pr" />
          <t:textedit composition="coffsinstance" cellname="repository_uuid" enabled="false" />
        </t:line>
        <t:line>
          <t:textedit composition="coffsinstance" cellname="repository_version" enabled="false" valuetype="integer" width="8x" />
          <t:textedit composition="coffsinstance" cellname="repository_roothash" enabled="false" />
        </t:line>
      </t:box>
      <t:box tid=".inclusionsettings" height="1pr">
        <t:arrayedit composition="fsinstance"
                     cellname="settings"
                     enabled="true"
                     height="1pr"
                     roweditscreen=".editsetting"
                     emptytid=".empty">
          <p:whfsrefcolumn name="fsobject" display="path" tid=".path" width="3pr" />
          <t:column name="self" type="text" tid=".self" width="1pr" />
          <t:column name="recursive" type="text" tid=".recursive" width="1pr" />
        </t:arrayedit>
      </t:box>
    </newtab>
  </propertyeditor>

  <screen name="editsetting"
          implementation="rowedit"
          xmlns="http://www.webhare.net/xmlns/tollium/screens"
          gid="editors"
          tid=".editsetting"
          allowresize="true">
    <compositions>
      <record name="row" />
    </compositions>
    <body>
      <p:browseforobject composition="row" cellname="fsobject"  />
      <select composition="row" cellname="self" type="pulldown">
        <option rowkey="full" tid=".full" />
        <option rowkey="partial" tid=".partial" enablecomponents="basefields" />
      </select>
      <select composition="row" cellname="recursive" type="pulldown">
        <option rowkey="full" tid=".full" />
        <option rowkey="ignore" tid=".ignore" />
      </select>
      <box tid=".basefields">
        <select name="basefields" title="" composition="row" cellname="basefields" type="checkbox" height="1pr" minheight="10x" >
          <option rowkey="type" />
          <option rowkey="ispinned" />
          <option rowkey="publish" />
          <option rowkey="title" />
          <option rowkey="description" />
          <option rowkey="indexdoc" />
          <option rowkey="template" />
          <option rowkey="profile" />
          <option rowkey="ordering" />
          <option rowkey="requiretemplate" />
          <option rowkey="requireprofile" />
          <option rowkey="requiretemplateinsubfolders" />
          <option rowkey="requireprofileinsubfolders" />
        </select>
      </box>
    </body>
    <footer>
      <defaultformbuttons buttons="ok cancel"/>
    </footer>

  </screen>

  <apply>
    <and>
      <to type="folder" />
      <not>
        <!-- FIXME returns false on new folders, due to bug in testdata impl ! -->
        <testdata target="self"
                  typedef="http://www.webhare.net/xmlns/blexdev_blit/v2/checkedoutfolder"
                  member="repository_url"
                  value="" />
      </not>
      <!-- extra rule that fails on new folders -->
      <testdata target="self"
                typedef="http://www.webhare.net/xmlns/blexdev_blit/v2/checkedoutfolder"
                member="emptydummyfield"
                value="" />
    </and>
    <extendproperties name="inclusionsettingseditor" requireright="system:sysop"/>
  </apply>

</siteprofile>

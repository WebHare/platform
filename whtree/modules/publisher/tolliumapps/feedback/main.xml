<screens xmlns="http://www.webhare.net/xmlns/tollium/screens"
         xmlns:wrd="http://www.webhare.net/xmlns/wrd/components"
         gid="tolliumapps.feedback"
         library="main.whlib">

  <screen name="main" allowresize="true" flags="issysop" gid=".main" icon="tollium:actions/checklist" menubar="menubar">
    <actions>
      <action name="escalate" onexecute="doescalate">
        <enableon source="feedback" min="1" checkflags="canescalate" />
      </action>
      <action name="close" onexecute="doclose">
        <enableon source="feedback" min="1" checkflags="canclose" />
      </action>
      <action name="reopen" onexecute="doreopen">
        <enableon source="feedback" min="1" checkflags="canreopen" />
      </action>
      <action name="delete" frameflags="issysop" onexecute="dodelete" shortcut="del" tid="~delete">
        <enableon source="feedback" min="1" />
      </action>
      <action name="togglefilter" onexecute="dotogglefilter" title="" />
      <action name="setfeedbackmulti" onexecute="dosetfeedbackmulti" title="" />
      <action name="setfeedbacksingle" onexecute="dosetfeedbacksingle" title="" />
      <action name="export" onexecute="doexport" tid="~export" />
      <action name="managetopics" frameflags="issysop" onexecute="domanagetopics" />
      <action name="manageroles" frameflags="issysop" onexecute="domanageroles" />
      <action name="settings" frameflags="issysop" onexecute="dosettings" tid="~settings" />
      <action name="exit" onexecute="doexit" shortcut="ctrl+q" tid="~exit" />
    </actions>

    <menus>
      <menu name="menubar">
        <item tid=".feedback">
          <item action="escalate" />
          <item action="close" />
          <item action="reopen" />
          <divider />
          <item tid=".forwardto" name="forwardtoitem"/>
          <divider />
          <item action="delete" />
        </item>
        <item action="export" />
        <item action="managetopics" disablemode="hidden" />
        <item action="manageroles" disablemode="hidden" />
        <item action="settings" disablemode="hidden" />
        <divider />
        <item action="exit" />
      </menu>
      <menu name="selectcontext">
        <item action="escalate" />
        <item action="close" />
        <item action="reopen" />
      </menu>
      <menu name="forwardtomenu" />
    </menus>

    <compositions>
      <eventlistener name="loglistener" onevents="onlogevent" />
    </compositions>

    <toolbar>
      <button action="escalate" icon="tollium:actions/escalate" />
      <button action="close" icon="tollium:status/positive" />
      <divider/>
      <button menu="forwardtomenu" icon="tollium:actions/forward" tid=".forwardto"/>
    </toolbar>

    <body spacers="none">
      <split type="horizontal" height="1pr">
        <part width="1pr">
          <panel backgroundcolor="#f0f0f0" borders="bottom">
            <line layout="tabs-space">
              <select name="status" type="pulldown" onchange="onselectstatus" title="">
                <option rowkey="" tid=".allstatuses" />
                <option rowkey="new" />
                <option rowkey="escalated" />
                <option rowkey="closed" />
              </select>
              <select name="role" type="pulldown" onchange="onselectrole" rowkeytype="integer" title="">
                <option rowkey="0" tid=".allroles" />
              </select>
              <spacer width="1pr" />
              <buttongroup borders="left right" layout="horizontal">
                <button name="listfilterbtn" action="togglefilter" hinttid=".filter" icon="tollium:actions/filter" title="" />
              </buttongroup>
              <buttongroup borders="left" layout="horizontal">
                <button name="feedbackmulti"
                        action="setfeedbackmulti"
                        hinttid=".feedbackmultihint"
                        icon="tollium:buttonbar/showmultirow"
                        title="" />
                <button name="feedbacksingle"
                        action="setfeedbacksingle"
                        hinttid=".feedbacksinglehint"
                        icon="tollium:buttonbar/showsinglerow"
                        title="" />
              </buttongroup>
            </line>
          </panel>
          <panel name="filterpanel" borders="bottom" spacers="left right" visible="false">
            <select name="topic" type="pulldown" onchange="onselecttopic" tid=".filtertopic">
              <option rowkey="" tid=".alltopics" />
            </select>
          </panel>
          <list name="feedback"
                height="1pr"
                borders="none"
                emptytid=".nofeedback"
                flags="canescalate canclose canreopen"
                ongetchildren="getfeedbackrows"
                onselect="onfeedbackselect"
                selectcontextmenu="selectcontext"
                selectmode="single"
                sortascending="false"
                sortcolumn="wrd_modificationdate"
                rowkeytype="entityid">
            <column name="feedbackid" type="text" width="12x" />
            <column name="status" type="text" width="10x" optiongid="tolliumapps.feedback.types" />
            <column name="wrd_creationdate" type="datetime" width="15x" precision="minutes" storeutc="true" />
            <column name="reportedby" type="text" linkname="reportedbylink" />
            <column name="topic" type="text" />
            <column name="remarks" type="text" width="3pr" />
            <column name="role" type="text" width="20x" />
            <rowlayout name="singlerow">
              <col coldef="feedbackid" />
              <col coldef="status" />
              <col coldef="wrd_creationdate" />
              <col coldef="reportedby" />
              <col coldef="topic" />
              <col coldef="role" />
              <col coldef="remarks" />
              <row>
                <cell coldef="feedbackid" />
                <cell coldef="status" />
                <cell coldef="wrd_creationdate" />
                <cell coldef="reportedby" />
                <cell coldef="topic" />
                <cell coldef="role" />
                <cell coldef="remarks" />
              </row>
            </rowlayout>
            <rowlayout name="multirow">
              <col coldef="feedbackid" />
              <col coldef="status" />
              <col coldef="wrd_creationdate" />
              <col coldef="reportedby" />
              <col coldef="role" />
              <row>
                <cell coldef="feedbackid" />
                <cell coldef="status" />
                <cell coldef="wrd_creationdate" />
                <cell coldef="reportedby" />
                <cell coldef="role" />
              </row>
              <row>
                <cell coldef="topic" />
                <cell coldef="remarks" colspan="4" />
              </row>
            </rowlayout>
          </list>
        </part>
        <part name="feedbackdetails" width="2pr" />
      </split>
    </body>
  </screen>

  <screen name="feedback"
          width="120x"
          height="30gr"
          allowresize="true"
          footerbuttons="close"
          gid=".feedback"
          savestate="size">
    <actions>
      <action name="addcomment" onexecute="doaddcomment" />
    </actions>

    <compositions>
      <record name="data" />
      <record composition="data" cellname="userdata" name="userdata" />
    </compositions>

    <body spacers="none">
      <tabs height="1pr">
        <tab name="comments" height="1pr">
          <panel height="1pr" borders="all">
            <iframe name="issuelog" height="1pr" />
          </panel>
          <textarea name="comment"
                    height="4gr"
                    defaultbutton="addcommentbutton"
                    enabled="false"
                    errorlabeltid=".comment"
                    maxlength="2000"
                    maxlengthmeasure="bytes"
                    required="true"
                    showcounter="true"
                    title="" />  <!-- will be enabled once issue is selected -->
          <line layout="right">
            <button name="addcommentbutton" action="addcomment" tid=".addcomment" />
          </line>
        </tab>
        <tab spacers="none" tid=".screenshot">
          <panel width="1pr" height="1pr" backgroundcolor="#ffffff">
            <panel name="urlpanel" borders="bottom" spacers="left right" visible="false">
              <line layout="tabs-space">
                <url name="url" width="1pr" title="" />
              </line>
            </panel>
            <iframe name="screenshot" width="1pr" height="1pr" />
          </panel>
        </tab>
        <tab tid=".metadata">
          <url name="shareurl" width="1pr" />
          <datetime composition="data"
                    cellname="wrd_creationdate"
                    type="datetime"
                    precision="minutes"
                    readonly="true"
                    storeutc="true" />
          <text composition="data" cellname="browser" selectable="true" wordwrap="true" />
          <text composition="data" cellname="device" selectable="true" wordwrap="true" />
          <text composition="data" cellname="useragent" selectable="true" wordwrap="true" />
          <text composition="userdata" cellname="login" selectable="true" />
          <heading name="extradata" visible="false" />
          <spacer name="extradatainsertpoint" visible="false" />
        </tab>
      </tabs>
    </body>
  </screen>

  <screen name="escalate" width="60x" height="15x" allowresize="true" footerbuttons="ok cancel" gid=".escalate">
    <body layout="left">
      <text labelfor="message" tid=".message" />
      <textarea name="message" width="1pr" height="1pr" title="" />
    </body>
  </screen>

  <screen name="managetopics" footerbuttons="close" gid=".managetopics" implementation="none">
    <body>
      <grid>
        <cell>
          <heading tid=".topics" />
          <wrd:entitiesedit width="40x"
                            deletemode="delete-denyreferred"
                            entityeditscreen="#edittopic"
                            orderable="true"
                            wrdtype="topic">
            <column name="wrd_title" type="text" tid=".topic" />
          </wrd:entitiesedit>
        </cell>
        <cell>
          <heading tid=".priorities" />
          <wrd:entitiesedit width="40x"
                            deletemode="delete-denyreferred"
                            entityeditscreen="#editpriority"
                            orderable="true"
                            wrdtype="priority">
            <column name="wrd_title" type="text" tid=".priority" />
          </wrd:entitiesedit>
        </cell>
      </grid>
    </body>
  </screen>

  <screen name="edittopic" footerbuttons="ok cancel" gid=".managetopics">
    <compositions>
      <wrd:entity name="entity" />
    </compositions>

    <body>
      <textedit composition="entity" cellname="wrd_tag" required="true" />
      <textedit composition="entity" cellname="wrd_title" required="true" />
      <inlineblock tid=".allowed_priorities">
        <select composition="entity"
                cellname="allowed_priorities"
                type="checkboxlist"
                onchange="onallowedpriorities"
                required="true">
          <wrd:runquery orderingtag="wrd_ordering" wrdtype="priority" />
        </select>
      </inlineblock>
      <select composition="entity" cellname="default_priority" type="pulldown" required="true" rowkeytype="integer">
        <option rowkey="0" invalidselection="true" title="" />
      </select>
      <select composition="entity" cellname="default_role" type="pulldown" required="true" rowkeytype="integer">
        <option rowkey="0" invalidselection="true" title="" />
        <wrd:runquery orderingtag="wrd_ordering" wrdtype="role" />
      </select>
    </body>
  </screen>

  <screen name="editpriority" footerbuttons="ok cancel" gid=".managetopics" implementation="wrd:entityedit">
    <compositions>
      <wrd:entity name="entity" />
    </compositions>

    <body>
      <textedit composition="entity" cellname="wrd_title" required="true" />
    </body>
  </screen>

  <screen name="manageroles" footerbuttons="close" gid=".manageroles" implementation="none">
    <body>
      <wrd:entitiesedit width="40x"
                        deletemode="delete-denyreferred"
                        entityeditscreen="#editrole"
                        orderable="true"
                        wrdtype="role">
        <column name="wrd_title" type="text" tid=".role" />
      </wrd:entitiesedit>
    </body>
  </screen>

  <screen name="editrole" footerbuttons="ok cancel" gid=".manageroles" implementation="wrd:entityedit">
    <compositions>
      <wrd:entity name="entity" />
    </compositions>

    <body>
      <textedit composition="entity" cellname="wrd_title" required="true" tid=".role" />
    </body>
  </screen>

  <screen name="settings" footerbuttons="ok cancel" gid=".settings">
    <body>
      <checkbox name="enabletolliumfeedback" labeltid=".enabletolliumfeedback" title="" />
    </body>
  </screen>

</screens>

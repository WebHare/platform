<?wh
LOADLIB "mod::socialite/lib/networkapi/linkedin_v2.whlib";
LOADLIB "mod::socialite/lib/networkapi/youtube.whlib";
LOADLIB "mod::socialite/lib/networkapi/vimeo.whlib";


STATIC OBJECTTYPE NetworkApp
<
  RECORD app;
  RECORD ARRAY appkeys;
  INTEGER sessionid;

  MACRO NEW(RECORD apprec)
  {
    this->app := apprec;
    this->appkeys := apprec.appkeys;
  }

  MACRO SetupForSession(RECORD session)
  {
    this->sessionid := session.id;
  }

  PUBLIC RECORD FUNCTION __ExecuteFeedQuery(STRING query, INTEGER maxnum)
  {
    THROW NEW Exception("This network application does not yet support feed queries");
  }
>;


OBJECTTYPE AccessTokenNetworkApp EXTEND NetworkApp
< STRING pvt_jsredirecturl;
  STRING pvt_publickey;

  PUBLIC PROPERTY jsredirecturl(pvt_jsredirecturl, -);

  MACRO NEW(RECORD apprec)
  : NetworkApp(apprec)
  {
  }

  MACRO SetupAccessTokenApp()
  {
    this->pvt_publickey := SELECT AS STRING value FROM this->appkeys WHERE tag = 'publickey';
    STRING privatekey := SELECT AS STRING value FROM this->appkeys WHERE tag = 'privatekey';
    STRING authcallbackhosturl := SELECT AS STRING value FROM this->appkeys WHERE tag = 'authcallbackhosturl';
    this->pvt_jsredirecturl := SELECT AS STRING value FROM this->appkeys WHERE tag = 'jsredirecturl';
    this->SetApplicationAuthKeys(this->pvt_publickey, privatekey);
    this->SetAuthCallbackHostURL(authcallbackhosturl);
  }
>;


PUBLIC OBJECTTYPE LinkedInV2NetworkApp EXTEND AccessTokenNetworkApp
<
  MACRO NEW(RECORD apprec)
  : AccessTokenNetworkApp(apprec)
  {
    EXTEND THIS BY LinkedInV2Connection;
    this->SetupAccessTokenApp();
  }
>;

PUBLIC OBJECTTYPE YoutubeNetworkApp EXTEND AccessTokenNetworkApp
<
  STRING developerkey;

  MACRO NEW(RECORD apprec)
  : AccessTokenNetworkApp(apprec)
  {
    EXTEND THIS BY YoutubeConnection;
    this->developerkey := SELECT AS STRING value FROM this->appkeys WHERE tag = "developerkey";
    this->SetupAccessTokenApp();
  }
>;

PUBLIC OBJECTTYPE VimeoNetworkApp EXTEND AccessTokenNetworkApp
<
  MACRO NEW(RECORD apprec)
  : AccessTokenNetworkApp(apprec)
  {
    EXTEND THIS BY VimeoConnection;
    this->SetupAccessTokenApp();
  }
>;

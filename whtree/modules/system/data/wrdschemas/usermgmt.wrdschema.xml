<schemadefinition xmlns="http://www.webhare.net/xmlns/wrd/schemadefinition"
                  accountstatus="active inactive blocked required"
                  accounttype="wrd_person">

  <import definitionfile="mod::wrd/data/wrdschemas/authschema.xml" />
  <import definitionfile="mod::wrd/data/wrdschemas/authschema_saml.xml" />
  <import definitionfile="mod::wrd/data/wrdschemas/authschema_oidc.xml" />
  <import definitionfile="mod::wrd/data/wrdschemas/idp.wrdschema.xml" />

  <migration tag="platform:accountstatus"
             at="update"
             revision="3"
             stage="beforeEntities"
             updatefunction="mod::platform/lib/internal/migrations.whlib#MigrateAccountStatus" />

  <attachment tag="whuser_role" linkfrom="whuser_unit" title="WebHare usermanagement role">
    <attributes>
      <free tag="wrd_title" title="Role title" />
      <free tag="whuser_comment" title="Usermanagement app comment" />
      <email tag="wrd_contact_email" />
    </attributes>
  </attachment>

  <domain tag="whuser_unit" title="WebHare usermanagement unit">
    <attributes>
      <free tag="wrd_title" title="Unit title" />
      <free tag="whuser_comment" title="Usermanagement app comment" />
      <boolean tag="override_passwordchecks" title="Override password checks" />
      <free tag="passwordchecks" title="Password check overrides for users in this unit" />
      <boolean tag="override_expiration" title="Override expiration settings" />
      <record tag="expiration" title="Expiration settings" />
      <obsolete tag="usereditpolicy" />
    </attributes>
  </domain>

  <object tag="wrd_person" title="Person">
    <attributes>
      <free tag="whuser_comment" title="Usermanagement app comment" />
      <datetime tag="whuser_lastlogin" title="Last login time" />
      <domainsingle tag="whuser_unit" domain="whuser_unit" required="true" title="Unit" />
      <domainmultiple tag="whuser_hiddenannouncements" domain="whuser_announcement" title="Hidden desktop announcements" />
    </attributes>
  </object>

  <!-- TODO obsolete this one
  <attachment tag="whuser_access_token" linkfrom="wrd_relation" title="WebHare API Access token">
    <attributes>
      <free tag="wrd_title" required="true" />
      <free tag="token" required="true" />
    </attributes>
  </attachment>
  -->
  <attachment tag="whuser_appaccount" linkfrom="wrd_relation" title="WebHare app account">
    <attributes>
      <free tag="device" title="Device" />
      <datetime tag="lastuse" title="Last usage" />
      <integer tag="type" title="Account type" />
      <free tag="passwordid" title="Password identifier" />
      <password tag="password" title="Actual password" />
      <free tag="scope" title="Account scope" />
    </attributes>
  </attachment>

  <attachment tag="whuser_peerserver" linkfrom="wrd_relation" title="WebHare peer server">
    <attributes>
      <free tag="wrd_title" title="Title" />
      <free tag="serverurl" title="Server URL" />
      <obsolete tag="username" />
      <obsolete tag="password" />
      <datetime tag="lastuse" title="Last usage" />
      <record tag="versioninfo" />
      <record tag="currenttoken" />
    </attributes>
  </attachment>

  <object tag="whuser_announcement" title="Desktop announcement">
    <attributes>
      <free tag="announcement_title" title="Announcement title" />
      <richdocument tag="announcement_text" title="Announcement text" />
      <domainmultiple tag="announcement_unit" domain="whuser_unit" title="Unit" />
      <domainsingle tag="announcement_author" domain="wrd_person" title="Author" />
      <datetime tag="publish_from" title="Start publication" />
      <datetime tag="publish_until" title="End publication" />
      <integer tag="target_language" required="false" title="Target language" />
    </attributes>
  </object>

</schemadefinition>

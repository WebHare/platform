<screens xmlns="http://www.webhare.net/xmlns/tollium/screens"
         xmlns:wrd="http://www.webhare.net/xmlns/wrd/components"
         gid="tolliumapps.config.mailrouting"
         library="mailrouting.whlib">

  <screen name="editmailserver" footerbuttons="ok cancel">
    <actions>
      <action name="testsmtpserver" onexecute="DoTestSMTPServer" />
    </actions>

    <compositions>
      <wrd:entity name="entity" wrdtype="mailserver" />
      <virtualcell composition="entity" cellname="serverurl" name="serverurl" onget="ongetserverurl" onset="onsetserverurl" />
    </compositions>

    <body>
      <checkbox name="defaultserver" labeltid=".defaultserver-label" />
      <textedit composition="entity" cellname="wrd_title" width="1pr" required="true" tid="~title" />
      <textedit name="hostname" width="1pr" required="true" />
      <line>
        <textedit name="port" width="6x" emptyvalue="0" required="true" valuetype="integer" />
        <text valuetid=".defaultport" />
      </line>
      <textedit name="authusername" tid="~username" />
      <textedit name="authpassword" password="true" tid="~password" />
      <line layout="right">
        <button action="testsmtpserver" />
      </line>
      <heading tid=".setheaders" />
      <arrayedit composition="entity"
                 cellname="setheaders"
                 height="1pr"
                 minwidth="50x"
                 minheight="4gr"
                 errorlabeltid=".setheaders"
                 roweditscreen="#editsetheaderrow">
        <column name="field" type="text" width="1pr" />
        <column name="value" type="text" width="1pr" />
      </arrayedit>
    </body>
  </screen>

  <screen name="senderconfig" footerbuttons="ok cancel">
    <body>
      <heading tid=".fallbackvalues" />
      <textedit name="mailfrom" required="true" validationchecks="email-maysendfrom" />
      <line layout="left">
        <checkbox name="usefornonwhitelisted" labeltid=".usefornonwhitelisted" title="" />
      </line>
    </body>
  </screen>

  <screen name="mailroutes" width="130x" height="40x" allowresize="true" footerbuttons="close">
    <actions>
      <action name="senderconfig" onexecute="dosenderconfig" tid="~edit" />
    </actions>

    <body spacers="none">
      <tabs height="1pr">
        <tab name="routestab">
          <heading tid=".mailroutes" />
          <wrd:entitiesedit name="routes"
                            height="1pr"
                            deletemode="close"
                            emptytid=".routesempty"
                            entityeditscreen="#editmailroute"
                            onmaprows="onmaproutes"
                            orderable="true"
                            wrdtype="mailroute">
            <column name="wrd_title" type="text" width="2pr" tid="~description" />
            <column name="sendermasks" type="text" width="2pr" tid=".sendermask" />
            <column name="recipientmasks" type="text" width="2pr" tid=".mask" />
            <column name="rewritemailaddress" type="text" width="2pr" tid=".outgoingmailaddress" />
            <column name="server" type="text" width="2pr" tid=".server" />
          </wrd:entitiesedit>
          <heading tid=".mailservers" />
          <wrd:entitiesedit name="mailservers"
                            height="1pr"
                            deletemode="delete-denyreferred"
                            emptytid=".serversempty"
                            entityeditscreen="#editmailserver"
                            onmaprows="onmapservers"
                            requestcolumns="wrd_tag wrd_title serverurl"
                            wrdtype="mailserver">
            <column name="wrd_title" type="text" width="2pr" tid="~title" />
            <column name="serverurl" type="text" width="2pr" tid=".serverurl" />
          </wrd:entitiesedit>
          <heading tid=".integrations" />
          <textedit name="snsendpoint" width="1pr" enabled="false" />
        </tab>
        <tab name="senderstab">
          <heading tid=".fallbackvalues" />
          <line>
            <textedit name="mailfrom" width="1pr" enabled="false" />
            <button action="senderconfig" />
          </line>
          <hr />
          <wrd:entitiesedit name="senders"
                            height="1pr"
                            deletemode="close"
                            emptytid=".sendersempty"
                            entityeditscreen="#editsender"
                            wrdtype="mailsender">
            <column name="mask" type="text" width="1pr" tid=".mask" />
            <column name="wrd_title" type="text" width="2pr" tid="~description" />
          </wrd:entitiesedit>
        </tab>
        <tab name="receiverstab">
          <wrd:entitiesedit name="receivers"
                            height="1pr"
                            deletemode="close"
                            emptytid=".receiversempty"
                            entityeditscreen="#editreceiver"
                            wrdtype="mailrecipient">
            <column name="mask" type="text" width="1pr" tid=".mask" />
            <column name="wrd_title" type="text" width="2pr" tid="~description" />
          </wrd:entitiesedit>
          <text width="1pr" valuetid=".receiverlistmaybeskipped" wordwrap="true" />
        </tab>
        <tab name="emailcorrectionstab">
          <wrd:entitiesedit name="emailcorrections"
                            height="1pr"
                            deletemode="close"
                            emptytid=".correctionsempty"
                            entityeditscreen="#editcorrection"
                            onmaprows="onmapcorrections"
                            orderable="true"
                            requestcolumns="masks wrd_title block rewriteto"
                            wrdtype="mailcorrection">
            <column name="wrd_title" type="text" width="2pr" tid="~description" />
            <column name="masks" type="text" width="2pr" tid=".mask" />  <!-- receivers (to) masks -->
            <column name="target" type="text" width="2pr" />  <!-- redirect all mails to: -->
          </wrd:entitiesedit>
        </tab>
      </tabs>
    </body>
  </screen>

  <screen name="editmailroute" width="70x" minwidth="60x" allowresize="true" footerbuttons="ok cancel">
    <compositions>
      <wrd:entity name="entity" wrdtype="mailroute" />
      <virtualcell composition="entity"
                   cellname="rewritemailaddress"
                   onget="getrewritemailaddress"
                   onset="setrewritemailaddress" />
    </compositions>

    <body>
      <textedit composition="entity" cellname="wrd_title" width="1pr" required="true" tid="~description" />
      <textedit composition="entity" cellname="wrd_tag" width="1pr" tid="~tag" />
      <textedit composition="entity" cellname="originmask" width="1pr" />
      <heading tid=".masks_from" />
      <arrayedit composition="entity"
                 cellname="sendermasks"
                 height="1pr"
                 minwidth="50x"
                 minheight="3x"
                 columnheaders="false"
                 errorlabeltid=".masks_from"
                 minrows="1"
                 roweditscreen="#editmaskrow">
        <column name="mask" type="text" width="1pr" />
      </arrayedit>
      <heading tid=".masks_to" />
      <arrayedit composition="entity"
                 cellname="recipientmasks"
                 height="1pr"
                 minwidth="50x"
                 minheight="3x"
                 columnheaders="false"
                 errorlabeltid=".masks_to"
                 minrows="1"
                 roweditscreen="#editmaskrow">
        <column name="mask" type="text" width="1pr" />
      </arrayedit>
      <heading tid=".outgoing" />
      <select name="smtpserver" type="radio" onchange="onsmtpserverchange">
        <option rowkey="use">
          <select composition="entity" cellname="server" type="pulldown" required="true" />
        </option>
        <option rowkey="null" />
      </select>
      <heading tid=".redirect" />
      <lines layout="left">
        <select name="outgoingredirect" type="radio" implicitenablecomponents="false" rowkeytype="boolean" title="">
          <option rowkey="false" />
          <option rowkey="true" enablecomponents="outgoingmailaddress entity.includeoriginaladdress">
            <textedit name="outgoingmailaddress"
                      width="1pr"
                      errorlabeltid=".outgoingmailaddress"
                      required="true"
                      title=""
                      validationchecks="email-maysendto" />
          </option>
        </select>
        <checkbox composition="entity" cellname="includeoriginaladdress" labeltid=".outgoingaddressrewrite" title="" />
      </lines>
    </body>
  </screen>

  <screen name="editmailrouterule" width="60x" footerbuttons="ok cancel">
    <compositions>
      <record name="row" />
    </compositions>

    <body>
      <textedit name="mask" width="1pr" required="true" />
    </body>
  </screen>

  <screen name="editsender" footerbuttons="ok cancel" implementation="wrd:entityedit">
    <compositions>
      <wrd:entity name="entity" />
    </compositions>

    <body>
      <textedit composition="entity" cellname="mask" width="1pr" required="true" />
      <textedit composition="entity" cellname="wrd_title" width="1pr" tid="~description" />
      <heading tid=".setheaders" />
      <arrayedit composition="entity"
                 cellname="setheaders"
                 height="1pr"
                 minwidth="50x"
                 minheight="4gr"
                 errorlabeltid=".setheaders"
                 roweditscreen="#editsetheaderrow">
        <column name="field" type="text" width="1pr" />
        <column name="value" type="text" width="1pr" />
      </arrayedit>
    </body>
  </screen>

  <screen name="editsetheaderrow" footerbuttons="ok cancel" implementation="rowedit">
    <compositions>
      <record name="row" />
    </compositions>

    <body>
      <textedit composition="row" cellname="field" width="1pr" required="true" />
      <textedit composition="row" cellname="value" width="1pr" />
    </body>
  </screen>

  <screen name="editreceiver" footerbuttons="ok cancel" implementation="wrd:entityedit">
    <compositions>
      <wrd:entity name="entity" />
    </compositions>

    <body>
      <textedit composition="entity" cellname="mask" width="1pr" required="true" />
      <textedit composition="entity" cellname="wrd_title" width="1pr" tid="~description" />
    </body>
  </screen>

  <screen name="editcorrection" footerbuttons="ok cancel">
    <compositions>
      <wrd:entity name="entity" wrdtype="MAILCORRECTION" />
    </compositions>

    <body>
      <heading tid=".masks" />
      <arrayedit composition="entity"
                 cellname="masks"
                 height="1pr"
                 minwidth="50x"
                 minheight="3x"
                 columnheaders="false"
                 errorlabeltid=".masks"
                 roweditscreen="#editmaskrow">
        <column name="mask" type="text" width="1pr" />
      </arrayedit>
      <select composition="entity"
              cellname="block"
              name="correctiontype"
              type="radio"
              rowkeytype="boolean"
              tid=".correctiontype">
        <option rowkey="false" enablecomponents="entity.rewriteto entity.suggestionfuzz" tid=".correctiontype-rewrite" />
        <option rowkey="true" tid=".correctiontype-block" />
      </select>
      <textedit composition="entity" cellname="rewriteto" required="true" />
      <textedit composition="entity" cellname="suggestionfuzz" valuetype="integer" />
      <textedit composition="entity" cellname="wrd_title" width="1pr" tid="~description" />
    </body>
  </screen>

  <screen name="editmaskrow" footerbuttons="ok cancel" implementation="rowedit">
    <compositions>
      <record name="row" />
    </compositions>

    <body>
      <textedit composition="row" cellname="mask" name="mask" width="1pr" required="true" />
    </body>
  </screen>

</screens>

<screens xmlns="http://www.webhare.net/xmlns/tollium/screens"
         xmlns:p="http://www.webhare.net/xmlns/publisher/components"
         gid="tolliumapps.config.keystore"
         library="keystore.whlib">

  <screen name="main" width="80x" allowresize="true" flags="issysop" footerbuttons="close" gid=".main">
    <actions>
      <action name="addkey" onexecute="doaddkey" />
      <uploadaction name="uploadkey" multiple="true" onupload="douploadkey" />
      <downloadaction name="downloadkey" frameflags="issysop" ondownload="dodownloadkey">
        <enableon source="keys" min="1" max="1" />
      </downloadaction>
      <action name="deletekey" onexecute="dodeletekey">
        <enableon source="keys" min="1" checkflags="candelete" />
      </action>
      <action name="generatecsr" onexecute="dogeneratecsr">
        <enableon source="keys" min="1" />
      </action>
      <action name="createselfsignedcert" onexecute="docreateselfsignedcert">
        <enableon source="keys" min="1" />
      </action>
      <uploadaction name="uploadcertificate" onupload="douploadcertificate">
        <enableon source="keys" min="1" />
      </uploadaction>
      <action name="viewcertificatechain" onexecute="doviewcertificatechain">
        <enableon source="keys" min="1" checkflags="have_certfile" />
      </action>
      <downloadaction name="downloadcertificate" ondownload="dodownloadcertificate">
        <enableon source="keys" min="1" max="1" checkflags="have_certfile" />
      </downloadaction>
      <action name="requestnewcertificate" onexecute="dorequestnewcertificate">
        <enableon source="keys" min="1" max="1"  />
      </action>
    </actions>

    <compositions>
      <eventlistener name="eventlistener" onevents="gotevents" />
    </compositions>

    <body>
      <grid width="1pr" height="1pr">
        <col width="1pr" />
        <col />
        <row height="1pr">
          <cell>
            <list name="keys"
                  height="1pr"
                  minheight="16x"
                  flags="have_certfile candelete"
                  icons="tollium:status/error tollium:status/warning tollium:status/checked"
                  ongetchildren="ongetkeys"
                  openaction="viewcertificatechain"
                  rowkeytype="fsobjectid"
                  selectmode="single">
              <column name="keyfile" type="text" />
              <column name="keylength" type="text" />
              <column name="certificate" type="icon" />
              <column name="validuntil" type="date" />
            </list>
          </cell>
          <cell>
            <button width="1pr" action="addkey" />
            <button width="1pr" action="uploadkey" />
            <button width="1pr" action="downloadkey" />
            <button width="1pr" action="deletekey" />
            <button width="1pr" action="viewcertificatechain" />
            <spacer height="1gr"/>
            <button width="1pr" action="generatecsr" />
            <button width="1pr" action="createselfsignedcert" />
            <button width="1pr" action="uploadcertificate" />
            <button width="1pr" action="downloadcertificate" />
            <spacer height="1gr"/>
            <button width="1pr" action="requestnewcertificate" />
          </cell>
        </row>
      </grid>
    </body>
  </screen>

  <screen name="createkey" footerbuttons="ok cancel" gid=".createkey">
    <body>
      <textedit name="name" required="true" />
      <textedit name="title" />
      <textedit name="bits" minvalue="2048" maxvalue="4096" required="true" value="2048" valuetype="integer" />
    </body>
  </screen>

  <screen name="createselfsignedcert" footerbuttons="ok" gid=".createselfsignedcert">
    <compositions>
      <record name="subject" />
    </compositions>

    <body>
      <textedit composition="subject" cellname="c" width="5x" maxlength="2" required="true" value="NL" />
      <textedit composition="subject" cellname="st" width="1pr" required="true" />
      <textedit composition="subject" cellname="l" width="1pr" required="true" />
      <textedit composition="subject" cellname="ou" width="1pr" required="true" />
      <textedit composition="subject" cellname="o" width="1pr" required="true" />
      <textedit composition="subject" cellname="cn" width="1pr" required="true" />
      <textarea name="altnames"
                height="6x"
                placeholdertid="tolliumapps.webservers.certbotrequest.domainnames-placeholder"
                tid="tolliumapps.webservers.certbotrequest.domainnames" />
      <datetime name="validuntil" type="datetime" required="true" storeutc="true" />
    </body>
  </screen>

  <screen name="generatecsr" footerbuttons="close" gid=".generatecsr">
    <actions>
      <action name="generate" onexecute="dogenerate" />
    </actions>

    <body>
      <textedit name="country" width="5x" maxlength="2" required="true" value="NL" />
      <textedit name="state" width="1pr" required="true" />
      <textedit name="locality" width="1pr" required="true" />
      <textedit name="organization" width="1pr" required="true" />
      <textedit name="organizationunit" width="1pr" required="false" />
      <textedit name="webserver" width="1pr" required="true" />
      <textarea name="altnames" width="1pr" height="6x" required="false" />
      <line>
        <button action="generate" />
      </line>
      <textarea name="csr" width="1pr" height="8x" minwidth="80x" enabled="false" />
    </body>
  </screen>

  <screen name="viewcertificatechain" footerbuttons="ok cancel" gid=".viewcertificatechain">
    <compositions>
      <p:whfsinstance name="keyfolder" typedef="http://www.webhare.net/xmlns/system/keystorefolder" />
    </compositions>

    <body>
      <list name="certificates" width="60x" height="8x" onselect="oncertificateselect" selectmode="single" sortable="false">
        <column name="commonname" type="text" tid=".certificatechain" />
      </list>
      <heading tid=".certificatedata" />
      <datetime name="validfrom" type="datetime" width="1pr" readonly="true" storeutc="true" />
      <line>
        <datetime name="validuntil" type="datetime" width="1pr" readonly="true" storeutc="true" />
        <text name="validuntil_expire" title="" />
      </line>
      <textedit name="subject" width="1pr" enabled="false" />
      <textedit composition="keyfolder"
                cellname="warnexpirydays"
                name="warnexpirydays"
                maxlength="5"
                minvalue="1"
                maxvalue="999"
                emptyvalue="0"
                suffixtid="~units.days"
                valuetype="integer" />
      <heading tid=".altnames" />
      <textarea name="dns_altnames" width="1pr" height="1pr" enabled="false" tid=".dns_altnames" />
      <heading tid=".signature" />
      <text name="signaturestatus" />
    </body>
  </screen>

</screens>

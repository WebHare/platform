<?wh

LOADLIB "mod::system/lib/database.whlib";
LOADLIB "mod::system/lib/internal/resourcemanager.whlib";
LOADLIB "mod::system/lib/tasks.whlib";

PUBLIC MACRO CheckSiteSettings()
{
  OBJECT trans := OpenPrimary();

  //can we shortcircuit and not update webserver config if it doesn't look like anything changed? or probably RefreshGlobalWebserverSettings should have such intelligence
  //reevaluate <webrules>
  RefreshGlobalWebserverConfig();
  //recheck indices
  trans->BeginWork();
  ScheduleTimedTask("consilio:update", [ allowmissing := TRUE ]); //we run very early in the bootstrap, so the tasks may not exist yet
  trans->CommitWork();
}

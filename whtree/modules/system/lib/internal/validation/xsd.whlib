<?wh
LOADLIB "mod::publisher/lib/webtools/internal/formcomponents.whlib";
LOADLIB "mod::system/lib/internal/validation/support.whlib";

LOADLIB "mod::tollium/lib/internal/componentparser.whlib";

PUBLIC STATIC OBJECTTYPE XSDValidator EXTEND XMLValidatorBase
<
  UPDATE PUBLIC MACRO ValidateDocument()
  {
    //ADDME generalize?
    RECORD res;
    IF(this->xml->GetElementsByTagNameNS("http://www.webhare.net/xmlns/publisher/forms", "formcomponent")->length > 0
       OR this->xml->GetElementsByTagNameNS("http://www.webhare.net/xmlns/publisher/forms", "formhandler")->length > 0)
    {
      res := ParseFormDefComponents(this->respath, this->xml);
      this->errors := this->errors CONCAT res.errors;
      this->warnings := this->warnings CONCAT res.warnings;
    }
    IF(this->xml->GetElementsByTagNameNS("http://www.webhare.net/xmlns/tollium/screens", "tolliumcomponent")->length > 0)
    {
      res := ParseComponentsXSD(this->respath, this->xml, RECORD[]);
      this->errors := this->errors CONCAT res.errors;
      this->warnings := this->warnings CONCAT res.warnings;

      FOREVERY(RECORD comp FROM res.components)
      {
        IF(comp.objtype != "")
          this->VerifyObjectExistence(comp.linenum, comp.objtype);
      }
    }
  }
>;


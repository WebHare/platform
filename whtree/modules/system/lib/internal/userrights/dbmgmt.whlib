<?wh
LOADLIB "mod::system/lib/database.whlib";
LOADLIB "mod::system/lib/internal/dbschema.whlib";

/// Table used to check dynamic rights table
PUBLIC TABLE
  < INTEGER id NULL := 0
  , INTEGER grantee NULL := 0
  , INTEGER grantor NULL := 0
  , INTEGER "object" NULL := 0
  , INTEGER "right" NULL := 0
  , DATETIME creationdate
  , BOOLEAN withgrantoption
  , STRING comment
  , STRING grantordata
  ; KEY id
  > rights_table;

/// Contains the name of the table that @a rights_table is currently bound to.
STRING current_rights_table;

/// Current generation of system schema mapping
INTEGER current_system_binding_gen;


/// Binds the table @a rights_table to the needed rights table
PUBLIC MACRO BindStorageTable(STRING tablename)
{
  IF (current_rights_table != tablename OR current_system_binding_gen != __system_binding_gen)
  {
    INTEGER trans := GetBindingFromSchema(system_internal).transaction;
    rights_table := BindTransactionToTable(trans, tablename);
    current_rights_table := tablename;
    current_system_binding_gen := __system_binding_gen;
  }
}


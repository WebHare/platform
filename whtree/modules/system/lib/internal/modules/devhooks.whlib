<?wh
/* devhooks.whlib defines points where the 'dev' module should hook us. We should probably completely replace it with APIs
   or intercept/target so we don't have to make any assumptions on how 'dev' implements all this
*/

LOADLIB "mod::system/lib/configure.whlib";
LOADLIB "mod::system/lib/resources.whlib";


PUBLIC MACRO LaunchLanguageFileEditor(OBJECT parent, STRING modulename)
{
  parent->contexts->controller->SendApplicationMessage("devkit:langedit", [ module := modulename ], DEFAULT RECORD, TRUE);
}

PUBLIC BOOLEAN FUNCTION CanOpenInEditor(OBJECT parent)
{
  RETURN IsModuleVersionMatch("dev", ">= 1.1.0"); //TODO or probe the dev module?
}

PUBLIC MACRO LaunchOpenInEditor(OBJECT parent, STRING resourcepath, RECORD options DEFAULTSTO DEFAULT RECORD)
{
  options := ValidateOptions([ line := 1
                             , col := 1
                             , closewindow := FALSE //a 'hack' used by the the error page
                             ], options);
  RunModuleHookTarget("system:devtools_openreveal", CELL[ contexts := ObjectExists(parent) ? parent->contexts : DEFAULT OBJECT, resourcepath, options.col, options.line, options.closewindow, openineditor := TRUE ]);
}

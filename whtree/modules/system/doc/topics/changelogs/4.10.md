# 4.10
## Incompatible changes
- publisher/contenttypes.whlib has been removed
- ScanBlob will always report application/octet-stream field for 0 byte files
- 'wh up' and 'wh umic' no longer imply a blit update

## Dominant color
- WebHare now calculates the dominant color for all images when they're stored into
  WHFS or WRD (or when `WrapBlob` is invoked with the `extractdominantcolor` option).
  All existing file/image records have been extended with a field 'dominantcolor'
  which will either be empty (unknown), a CSS color code (eg #123456) or 'transparent' (no dominant color)
- All fsobjects, fssettings and wrd settings which contain an image will be converted
  in the background after you upgrade.
  - To check on the progress of this conversion, run `watch wh scandataprogress` or `wh scandataprogress`
  - To abort conversion (eg due to unexpected high load), delete all `system:convertscandata` tasks in monitor > managed tasks
  - To restart conversion after aborting, run the kickstart script: `wh run mod::system/scripts/runonce/kickstart_scandata_conversions.whscr`.
    As this script needs to find the highest allocated settingid for WHFS and WRD, it may take a few minutes to run.

## HareScript
- DecodeValue and DecodeHTML now remove all HTML tags from their input, instead of just entities and `<br />`
- `Resolve(STRING relativepath)` resolves the specified path against the current library. Eg. `Resolve("page.witty")` will
  give you the `mod::x/y/z/page.witty` path for the file `page.witty` in the folder next to your current whlib.

## Publisher
- Both URL history storage and redirect-on-404 are now enabled by default. You need to explicitly opt out of URL history
- The URL history dialogs are now always available for published files, they no longer check for the URL history 'store' flag
- The URL history now preserves any part following the /!/ separator
- Siteprofiles `<apply><to>` rules support regular expressions in attributes `pathregex`, `parentpathregex` and `siteregex`.
  Regexes are tested case-insensitively, but be sure to anchor them.. you probably want `^/tmp/myfolder$/` and not just `tmp/myfolder`...

## WRD
- Simplify API2017 migration:
  - `->GetType(STRING)` now works on both API2017 and legacy schema objects. It will always return a API2017 WRDType! (legacy schemas
     still support calling `GetType` with an INTEGER parameter and will return a legacy wrdtype)
  - The `types` member is now also available on legacy schema objects, but will always return API2017 WRDTypes.


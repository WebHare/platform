# 4.31 - Current master

## Incompatibilities and deprecations
- Various WRDAuth deprecations and removals to make room for 2FA support, contact us if you need any of these APIs:
  - Removes the following APIs from wrdauth: ProcessPasswordReset, ProcessPasswordResetPost, CreateEmailVerificationLink,
    HandleEmailVerificationPage, HandleEmailVerificationData, UpdateUserAccountFields, UpdateUserPassword, GetWRDAuthConfig,
    PrepareMail
  - Removes `wrdauth` from the wrdauth plugin. It will be temporary available as `__GetWRDAuth()` but our intention is to
    completely remove the object 'behind' wrdauth and merge it into the plugin, so don't rely on this one staying around or
    receiving a warning when it finally goes away.
  - Support for wrdauth plugins overriding `VerifyPassword` has been removed
  - `passwordpolicy` and `passwordcheck` can no longer be overridden by wrdauth plugins
  - Password fields no longer support `onpolicycheck` and `policy`/`policytid`
  - `onpolicycheck` and `policy(tid)` are no longer supported by Tollium `<password>` fields. Policy should be specified using `validationchecks`
- JS import `dompack/browersfix/url` is obsolete, the WebHare polyfill already fixes this. You can just remove this import everywhere (at least back to 4.28)
- We are strongly considering deprecating deriving from WebtoolFormBase and to have the RPCs always use the 'fast' path, avoiding
  the webdesign too. We need to know about use cases which cannot switch to the faster webtool formhooks.
- The module `dompack` has been merged into WebHare
- The split datetimefields used non-BEM-ified classes for year/month/day/hour/minute/second classes. This has now been fixed.
- Emails no longer receive a `X-WebHare-Origin` header as this is a potential information leak. The origin is now shown
  with the mail headers in the dashboard.
- %IsRPCTrafficLogged is now implicitly checked by %LogRPCForWebbrowser, %LogRPCTraffic and %LogCurrentRequestToRPCLog. %IsRPCTrafficLogged will be deprecated as a public API
- `system/js/compat/cookie.es` has been removed as there seem to be no more users. Use `dompack/extra/cookie.es` if you still used it.

## Things that are nice to know
- `<filetype kind="rawfile">` didn't actually imply 'requirescontent' - documentation updated
- The label on the send button in the standard maildialog can be overridden by passing `sendbuttontitle` to %RunSendEmailDialog
- A new type of schedulde task "Replace with..." allows you to replace the contents of an existing file at a specific time.
- Webtool form hooks can add 'hidden' fields which will be present in the final form results.
- Adds %GetYearlyHoliday to calculate when well known holidays are celebrated
- All `<text>`s components in Tollium should have a selectable value now, even when not explicitly set as selectable
- Moduledefinitions now support `<customsource>` in `<catalog>` nodes to define module content sources
- Adds 'Download original' button to image properties in the RTD
- `dompack/extra/storage.es` offers convenience wrappers for localStorage and sessionStorage, adding a fallback storage
  in case storage itself throws (eg due to privacy settings). It also isolates storage if `<html data-wh-isolate-storage>`
  is set - this is used so eg. widget previews don't disturb each other or CI tests.
- Tollium `<richdocument>` supports a `usercss` property which contains additional CSS to include after the RTD css files

## Things you should do

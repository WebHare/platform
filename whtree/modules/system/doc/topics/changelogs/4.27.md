# 4.27 - current master

## Incompatibilities and deprecations
- *PLEASE NOTE:* WebHare 4.26 is NOT skippable. You must upgrade to 4.26 before upgrading to 4.27
- We no longer create `/webhare-moduledata/` in WHFS - modules should use `/webhare-private/`.
  - Note that 4.26 added %OpenWHFSPrivateFolder to find your module's private folder and ensures that this folder is always
    created.
- Support for mixed-case webserver output has been removed. Lowercase output paths are enforced for all servers
- Support for `editcomponent=` on widget types has been removed.
- We no longer generate `wh-rtd__anchor` classes, only `wh-anchor` (a few previous versions generated both for the transition phase)
- The `google` substitution module has been removed. If you had an old or empty version of it, you may still need to `wh module rm google`
  to completely remove it. You may also need to drop the `google` schema in the database
- `tolliumcontroller->debug` and `ScreenBase::debug` have been removed
- Support for bower has been dropped.
- `StartPreciseTimer`, `StopPreciseTimer` and `GetUnixExtendedTimestamp` have been removed. Use %GetUnixTimestampMsecs
  - `GetUnixTimestampMsecs(GetCurrentDatetime())` gives you an INTEGER64 contaning the current number of msecs.
- Accessing registry keys starting with `system.modules.` or `modules.` will now trigger an error on development servers.
- Old registry APIs have been removed:
  - The freestanding `SetRegistryKey` and `GetRegistryKey` (which accepted a role id) have been removed. This does not affect the `TolliumUser` registry APIs.
  - `ReadModuleRegistryKey` and `WriteModuleRegistryKey` have been removed.
- Potential WHDB/Postgres compatibility issues:
  - Role APIs `GetWHDBRoleId` and `IsWHDBRoleEnabled` have been removed.
  - `MakeWHDBAutoNumber` was already deprecated, and is now removed. Switch to %MakeAutonumber.
  - All other WHDB APIs have been marked for deprecation as relying on anything from `wh::dbase/whdb.whlib` is unsafe now.
  - Old SSHA1-hashed passwords with binary data in WRD are converted to base64. These passwords cannot be checked anymore by older
    WebHare versions (eg if you migrate WRD data to an older version)
- %IsValidUTF8 has been aligned more closely with PostgreSQL and now always rejects NUL (`\0`) bytes and surrogate pairs.
- The legacy image cache (GetCachedRemoteDataURL and GetCachedRemoteImgURL) has been removed.
- wkhtmltopdf and qpdf have been removed
- `WRDLegacyType::GetDomVals` now throws on test and development servers and should be replaced with `ListDomVals`
- The `WebHare usermanagement` schema has been renamed to `system:usermgmt`

## Things that are nice to know
- Fixes a bug causing images to be deleted if they were added from the publisher and their original was deleted
- WebDesignBase and WidetBase now offer GetRTDBody which wraps OpenRTD and RenderAllObjects in a witty friendly way (by returning
  a default value when the document is empty). This allows you to replace the pattern
  `RecordExists(richdoc) ? PTR webdesign->OpenRTD(richdoc)->RenderAllObjects : DEFAULT MACRO PTR` with just `webdesign->GetRTDBody(richdoc)`
- `<runonce>` migrations can now be dropped in a `mod::<module>/migrations/<phase>` folder, eg `mod::mymod/migrations/poststart/20190927-upgrade.whscr`
- %RequireHTTPLogin adds a simple way to protect pages with basic HTTP authentication. `wh registry set` now hash a `--password` option to directly set
  a safe password
- A builtin webdesign `No webdesign` has been added for if you just want to upload a few HTML files without any design into the publisher
- `none` is now an acceptable SameSite value in UpdateWebCookie. See also https://blog.chromium.org/2019/10/developers-get-ready-for-new.html
- Added %ConvertContentTypes to convert between content types (eg to migrate old data or merge similar types)
- New LetsEncrypt certificates can now be requested through the webserver application

## Things you should do

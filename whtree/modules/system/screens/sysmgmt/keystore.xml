<screens xmlns="http://www.webhare.net/xmlns/tollium/screens"
         xmlns:system="http://www.webhare.net/xmlns/system/components"
         lib="screens/sysmgmt/keystore.whlib"
         gid="sysmgmt.keystore">

  <messageboxes>
    <messagebox name="invalidhostname" icon="question" buttons="yes no" />
    <messagebox name="invalidkeyfile" icon="error" buttons="ok" />
    <messagebox name="suredeletekey" icon="question" buttons="yes no" />
    <messagebox name="overwritewithselfsigned" icon="question" buttons="yes no" />
  </messageboxes>

  <screen gid=".main" name="main" allowresize="true" width="80x" savestate="size" flags="issysop">
    <actions>
      <action name="addkey" onexecute="doaddkey" />
      <uploadaction name="uploadkey" onupload="douploadkey" multiple="true" />
      <downloadaction name="downloadkey" ondownload="dodownloadkey" frameflags="issysop">
        <enableon source="keys" min="1" max="1" />
      </downloadaction>
      <action name="deletekey" onexecute="dodeletekey">
        <enableon source="keys" min="1" checkflags="candelete" />
      </action>
      <action name="generatecsr" onexecute="dogeneratecsr">
        <enableon source="keys" min="1" />
      </action>
      <action name="createselfsignedcert" onexecute="docreateselfsignedcert">
        <enableon source="keys" min="1" />
      </action>
      <uploadaction name="uploadcertificate" onupload="douploadcertificate">
        <enableon source="keys" min="1" />
      </uploadaction>
      <action name="viewcertificatechain" onexecute="doviewcertificatechain">
        <enableon source="keys" min="1" checkflags="have_certfile" />
      </action>
      <downloadaction name="downloadcertificate" ondownload="dodownloadcertificate">
        <enableon source="keys" min="1" max="1" checkflags="have_certfile" />
      </downloadaction>
    </actions>

    <compositions>
      <eventlistener name="eventlistener" onevents="gotevents" />
    </compositions>

    <body>
      <grid width="1pr" height="1pr">
        <col width="1pr" />
        <col />
        <row height="1pr">
          <cell>
            <list name="keys"
                  height="1pr"
                  ongetchildren="ongetkeys"
                  selectmode="single"
                  icons="tollium:status/error tollium:status/warning tollium:status/checked"
                  flags="have_certfile candelete"
                  minheight="16x"
                  openaction="viewcertificatechain">
              <column name="keyfile" type="text" />
              <column name="keylength" type="text" />
              <column name="certificate" type="icon" />
              <column name="validuntil" type="date" />
            </list>
          </cell>
          <cell>
            <button action="addkey" width="1pr" />
            <button action="uploadkey" width="1pr" />
            <button action="downloadkey" width="1pr" />
            <button action="deletekey" width="1pr" />
            <button action="viewcertificatechain" width="1pr" />
            <panel spacers="top" />
            <button action="generatecsr" width="1pr" />
            <button action="createselfsignedcert" width="1pr" />
            <button action="uploadcertificate" width="1pr" />
            <button action="downloadcertificate" width="1pr" />
          </cell>
        </row>
      </grid>
    </body>
    <footer>
      <defaultformbuttons buttons="close" />
    </footer>
  </screen>

  <screen gid=".createkey" name="createkey">
    <body>
      <textedit name="name" required="true" />
      <textedit name="title" />
      <textedit name="bits" valuetype="integer" value="2048" minvalue="2048" maxvalue="4096" required="true" />
    </body>
    <footer>
      <defaultformbuttons buttons="ok cancel" />
    </footer>
  </screen>

  <screen gid=".createselfsignedcert" name="createselfsignedcert">
    <compositions>
      <record name="subject" />
    </compositions>
    <body>
      <textedit composition="subject" cellname="c" value="NL" width="5x" required="true" maxlength="2" />
      <textedit composition="subject" cellname="st"  width="1pr" required="true" />
      <textedit composition="subject" cellname="l"  width="1pr" required="true" />
      <textedit composition="subject" cellname="ou" width="1pr" required="true" />
      <textedit composition="subject" cellname="o"  width="1pr" required="true" />
      <textedit composition="subject" cellname="cn" width="1pr" required="true" />
      <textarea name="altnames" height="6x" width="1pr"  required="false" />
      <datetime name="validuntil" type="datetime" storeutc="true" required="true" />
    </body>
    <footer>
      <defaultformbuttons buttons="ok"/>
    </footer>
  </screen>

  <screen gid=".generatecsr" name="generatecsr">
   <actions>
      <action name="generate" onexecute="dogenerate" />
    </actions>
    <body>
      <textedit width="5x" required="true" maxlength="2" name="country" value="NL" />
      <textedit width="1pr" required="true" name="state" />
      <textedit width="1pr" required="true" name="locality" />
      <textedit width="1pr" required="true" name="organization" />
      <textedit width="1pr" required="false" name="organizationunit" />
      <textedit width="1pr" required="true" name="webserver"/>
      <textarea height="6x" width="1pr"  required="false" name="altnames" />
      <line>
        <button action="generate" />
      </line>
      <textarea name="csr" enabled="false" height="8x" width="1pr" minwidth="80x" />
    </body>
    <footer>
      <defaultformbuttons buttons="close"/>
    </footer>
  </screen>

  <screen name="viewcertificatechain"
          gid=".viewcertificatechain">
    <body>
      <list name="certificates"
            selectmode="single"
            onselect="oncertificateselect"
            sortable="false"
            height="8x"
            width="60x">
        <column name="commonname" tid=".certificatechain" type="text" />
      </list>
      <heading tid=".certificatedata" />
      <datetime name="validfrom" readonly="true" width="1pr" type="datetime" storeutc="true" />
      <line>
        <datetime name="validuntil" readonly="true" width="1pr" type="datetime" storeutc="true" />
        <text name="validuntil_expire" title="" />
      </line>
      <textedit name="subject" enabled="false" width="1pr" />
      <heading tid=".altnames" />
      <textarea name="dns_altnames" tid=".dns_altnames" enabled="false" width="1pr" height="1pr" />
      <heading tid=".signature" />
      <text name="signaturestatus" />
    </body>
    <footer>
      <defaultformbuttons buttons="close" />
    </footer>
  </screen>

</screens>

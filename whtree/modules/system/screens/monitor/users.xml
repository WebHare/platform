<screens xmlns="http://www.webhare.net/xmlns/tollium/screens" gid="monitor" library="/lib/screens/monitor/users.whlib">

  <screen name="users" gid=".users" title="">
    <actions>
      <action name="kill" shortcut="del" title="">
        <enableon source="onlineusers" min="1" checkflags="haveapplications" onexecute="dokillallsessions" />
        <enableon source="apps" min="1" onexecute="dokillsession" />
      </action>
      <action name="sendmessagetouser" onexecute="dosendmessagetouser">
        <enableon source="onlineusers" min="1" checkflags="haveapplications" onexecute="dosendmessagetouser" />
      </action>
      <action name="sendglobalmessage" onexecute="dosendglobalmessage" />
      <action name="openwebharelogin" onexecute="doopenwebharelogin" />
      <action name="closewebharelogin" onexecute="doclosewebharelogin" />
    </actions>

    <menus gid=".menus">
      <menu name="usercontextmenu">
        <item action="sendmessagetouser" />
        <divider />
        <item action="kill" tid=".killallsessions" />
      </menu>
      <menu name="appcontextmenu">
        <item action="kill" tid=".killsession" />
      </menu>
    </menus>

    <body height="1pr" spacers="none">
      <split type="vertical">
        <part height="3pr">
          <grid height="1pr">
            <col width="1pr" />
            <col />
            <row height="1pr">
              <cell>
                <list name="onlineusers"
                      height="1pr"
                      borders="right"
                      flags="haveapplications"
                      highlightname="isself"
                      onselect="onuserselect"
                      selectcontextmenu="usercontextmenu"
                      selectmode="single">
                  <column name="username" type="text" />
                  <column name="realname" type="text" />
                  <column name="logintime" type="datetime" width="18x" precision="seconds" storeutc="true" />
                  <column name="lastaccess" type="datetime" width="18x" precision="seconds" storeutc="true" />
                  <column name="ipaddress" type="text" width="11x" sortkeyname="ipaddress_sort" />

                  <!-- column name="typename" type="text" / -->
                  <column name="appcount" type="text" width="12x" align="right" />

                  <!-- <column name="appmemory" type="text" width="12x" align="right" /> -->
                </list>
              </cell>
              <cell spacers="left right">
                <box hr="false" tid=".messaging">
                  <button width="1pr" action="sendmessagetouser" />
                  <button width="1pr" action="sendglobalmessage" />
                </box>
                <box hr="false" tid=".loginstatus">
                  <text name="loginstatus" title="" />
                  <line layout="left">
                    <button width="1pr" action="openwebharelogin" />
                    <button width="1pr" action="closewebharelogin" />
                  </line>
                </box>
                <heading tid=".stats" />
                <text name="total_onlineusers" />
                <text name="total_appcount" />
                <text name="total_appmemory" />
              </cell>
            </row>
          </grid>
        </part>
        <part height="2pr">
          <grid height="1pr">
            <col width="1pr" />
            <col />
            <row height="1pr">
              <cell>
                <panel spacers="left">
                  <heading tid=".apps" />
                </panel>
                <list name="apps"
                      height="1pr"
                      borders="top right"
                      onselect="onapplicationselect"
                      selectcontextmenu="appcontextmenu"
                      selectmode="single">
                  <column name="sessionid" type="text" width="18x" tid=".sessionid" />
                  <column name="ipaddress" type="text" width="11x" tid=".ipaddress" />

                  <!-- <column type="text" name="running" tid=".running" width="4x" /> -->
                  <column name="started" type="text" width="8x" tid=".timestarted" />
                  <column name="lastactive" type="text" width="8x" tid=".lastactive" />

                  <!-- <column type="text" name="lastpoll" tid=".lastpoll" width="8x" /> -->

                  <!-- <column type="text" name="memusage" tid=".memoryusage" width="11x" align="right" />
                  <column type="text" name="objects" tid=".objectcount" width="8x" align="right" /> -->
                  <column name="app" type="text" width="25x" tid=".application" />
                  <column name="title" type="text" tid=".applicationtitle" />

                  <!-- <column type="text" name="starturl" tid=".starturl" width="1pr" /> -->
                  <column name="browser" type="text" />
                </list>
              </cell>
              <cell>
                <box name="appstats" width="28x" visible="false">
                  <text name="backingstore" />
                  <text name="blobstore" />
                  <text name="heap" />
                  <text name="stack" />
                  <text name="instructions" />
                  <text name="library" visible="false" />  <!-- current almost always modules/system/scripts/internal/tolliums.shtml, so not really interesting -->
                  <text name="objectcount" />
                </box>
              </cell>
            </row>
          </grid>
        </part>
      </split>
    </body>
  </screen>

  <screen name="sendmessage"
          width="100x"
          height="30x"
          minwidth="70x"
          allowresize="true"
          footerbuttons="ok cancel"
          gid=".sendmessage"
          savestate="size position">
    <body>
      <box name="applytemplate" visible="false">
        <select name="template" type="pulldown" flags="showserverupdate" onchange="ontemplatechange">
          <option rowkey="none" />
          <divider />
          <option rowkey="serverupdate" flags="showserverupdate" selected="true" />
        </select>
        <tabs type="server" height="1pr">
          <tab>
            <visibleon checkflags="showserverupdate" min="1" source="template" />
            <box hr="false" tid=".serverupdate">
              <datetime name="updatewhen" type="datetime" onselect="ontemplatechange" precision="minutes" />
              <line>
                <textedit name="updatetime" width="5x" onchange="ontemplatechange" value="5" valuetype="integer" />
                <text title="" valuetid=".minutes" />
              </line>
            </box>
          </tab>
        </tabs>
      </box>
      <box height="1pr" hr="false" tid=".message" vscroll="true">
        <textedit name="title" maxlength="50" required="true" />
        <textarea name="msg" height="1pr" maxlength="200" required="true" />
      </box>
    </body>
  </screen>

</screens>

<?wh

LOADLIB "mod::publisher/lib/feedback.whlib";

LOADLIB "mod::tollium/lib/screenbase.whlib";


PUBLIC STATIC OBJECTTYPE Feedback EXTEND TolliumScreenBase
<
  STRING guid;

  MACRO Init(RECORD data)
  {
    IF (NOT RecordExists(data.target))
      THROW NEW Exception("This app is not meant to be run manually");
    this->guid := data.target.guid;

    ^extradata->^extrafields->value :=
        [ [ field := "type",    type := "tid",    tid := /*tid*/"tollium:tolliumapps.feedback.type" ]
        , [ field := "remarks", type := "string", tid := /*tid*/"tollium:tolliumapps.feedback.remarks" ]
        ];
  }

  RECORD FUNCTION Submit()
  {
    OBJECT work := this->BeginWork();
    StoreFeedbackExtraData(this->guid, ^extradata->value );
    IF (work->Finish())
    {
      this->RunSimpleScreen("info", this->GetTid(".thankyou"));
      RETURN ^extradata->value;
    }
    RETURN DEFAULT RECORD;
  }
>;

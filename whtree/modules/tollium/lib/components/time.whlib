<?wh
LOADLIB "wh::datetime.whlib";
LOADLIB "mod::tollium/lib/componentbase.whlib";
LOADLIB "mod::tollium/lib/screenbase.whlib";

/////////////////////////////////////////////////////////////////////
// Time field
PUBLIC OBJECTTYPE TolliumTime EXTEND TolliumFragmentBase
<
  PUBLIC PROPERTY value(GetValue, SetValue);
  PUBLIC PROPERTY invalidtime(^dt->invalidtime, -);
  PUBLIC PROPERTY precision(^dt->precision, ^dt->precision);     ///< Allowed values: 'minutes'/'seconds'/'milliseconds'
  UPDATE PUBLIC PROPERTY readonly(^dt->readonly, ^dt->readonly);
  UPDATE PUBLIC PROPERTY required(^dt->required, ^dt->required);
  UPDATE PUBLIC PROPERTY title(^dt->title, ^dt->title);
  UPDATE PUBLIC PROPERTY errorlabel(^dt->errorlabel, ^dt->errorlabel);

  MACRO NEW()
  {
    EXTEND this BY TolliumIsComposable;
    EXTEND this BY TolliumIsDirtyable;

    this->invisibletitle := TRUE;
  }

  UPDATE PUBLIC MACRO StaticInit(RECORD def)
  {
    TolliumFragmentBase::StaticInit(def);
    this->precision := def.precision;
    this->title := this->pvt_title;
    this->required := def.required;
    this->readonly := def.readonly;
  }

  UPDATE MACRO PreInitComponent()
  {
    this->dt->dirtylistener := this->dirtylistener;
  }

  INTEGER FUNCTION GetValue()
  {
    RETURN this->dt->value = DEFAULT DATETIME ? - 1 : GetMsecondCount(this->dt->value);
  }
  MACRO SetValue(INTEGER newtime)
  {
    IF(newtime<0)
      this->dt->value := DEFAULT DATETIME;
    ELSE
      this->dt->value := MakeDateFromParts(1, newtime);
  }
  UPDATE PUBLIC BOOLEAN FUNCTION IsValidValue(VARIANT value)
  {
    RETURN TypeID(value) = TypeID(INTEGER);
  }

  UPDATE PUBLIC MACRO ValidateValue(OBJECT work)
  {
    this->dt->ValidateValue(work);
  }
>;
